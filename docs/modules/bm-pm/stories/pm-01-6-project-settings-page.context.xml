<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>pm-01</epicId>
    <storyId>pm-01-6</storyId>
    <title>Project Settings Page</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-17</generatedAt>
    <generator>BMAD Story Context Workflow (manual)</generator>
    <sourceStoryPath>docs/modules/bm-pm/stories/pm-01-6-project-settings-page.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>project lead</asA>
    <iWant>to configure project settings</iWant>
    <soThat>I can customize behavior for my team</soThat>
    <tasks>
      - Ensure project lead can mutate project + phases (API side)
      - Build settings UI with autosave, phases editing, archive/delete
    </tasks>
  </story>

  <acceptanceCriteria>
    - Only project lead/admin can access settings.
    - Settings sections: General, Automation, Phases, Danger Zone.
    - Autosave with "Saved" toast.
    - Archive sets status=ARCHIVED.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      - docs/modules/bm-pm/epics/epic-pm-01-project-phase-management.md (Story PM-01.6)
    </docs>
    <code>
      - apps/api/src/pm/projects/projects.controller.ts (allow member + lead check)
      - apps/api/src/pm/projects/projects.service.ts (create team, lead assertion)
      - apps/api/src/pm/phases/phases.controller.ts + phases.service.ts (lead assertion)
      - apps/web/src/app/(dashboard)/dashboard/pm/[slug]/settings/page.tsx (replace placeholder)
      - apps/web/src/hooks/use-pm-projects.ts (add update/delete hooks)
    </code>
    <dependencies>
      - react-hook-form + zod (form state and validation)
      - React Query mutations (autosave)
      - sonner toast
    </dependencies>
  </artifacts>

  <constraints>
    - Enforce workspace scoping server-side and project-lead checks for members.
    - Keep autosave debounced to avoid excessive requests.
  </constraints>

  <interfaces>
    - PATCH /pm/projects/:id
    - DELETE /pm/projects/:id
    - POST /pm/projects/:projectId/phases
    - PATCH /pm/phases/:id
  </interfaces>

  <tests>
    <standards>
      - Extend existing unit tests to cover create initializes team and lead checks.
    </standards>
    <locations>
      - apps/api/src/pm/projects/projects.service.spec.ts
    </locations>
  </tests>
</story-context>

