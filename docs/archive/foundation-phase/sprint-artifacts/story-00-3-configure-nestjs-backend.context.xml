<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <metadata>
    <story-id>00-3</story-id>
    <story-title>Configure NestJS Backend</story-title>
    <generated>2025-12-01</generated>
    <epic>EPIC-00 - Project Scaffolding &amp; Core Setup</epic>
    <story-points>2</story-points>
    <priority>P0 - Critical</priority>
  </metadata>

  <story-summary>
    Configure NestJS 10 backend application in apps/api directory with modular architecture,
    Swagger/OpenAPI documentation, environment validation, CORS configuration, health check endpoint,
    and global validation pipeline. The backend will run on port 3001 and serve as the foundation
    for all modular business logic in the HYVVE platform.

    This story sets up the NestJS scaffolding ONLY - no business logic, database connections, or
    authentication yet. Those will be implemented in subsequent stories.
  </story-summary>

  <acceptance-criteria>
    <criterion id="AC1">
      <description>NestJS application initialized in apps/api directory</description>
      <verification>Directory structure exists with src/main.ts, src/app.module.ts, src/app.controller.ts, src/app.service.ts</verification>
    </criterion>

    <criterion id="AC2">
      <description>Base modules configured (App Module, Common Module)</description>
      <verification>AppModule imports CommonModule; CommonModule contains guards, interceptors, filters</verification>
    </criterion>

    <criterion id="AC3">
      <description>Swagger/OpenAPI documentation configured and accessible at /api/docs</description>
      <verification>Navigate to http://localhost:3001/api/docs and verify Swagger UI loads with health endpoint documented</verification>
    </criterion>

    <criterion id="AC4">
      <description>Environment validation implemented with required variables</description>
      <verification>Remove required env var and verify application fails to start with clear validation error</verification>
    </criterion>

    <criterion id="AC5">
      <description>Health check endpoint implemented at /health returning 200 OK with { status: 'ok', timestamp: string }</description>
      <verification>curl http://localhost:3001/health returns {"status":"ok","timestamp":"2025-12-01T..."}</verification>
    </criterion>

    <criterion id="AC6">
      <description>CORS configured to accept requests from localhost:3000 (Next.js frontend)</description>
      <verification>Make request from frontend to backend and verify no CORS errors in browser console</verification>
    </criterion>

    <criterion id="AC7">
      <description>NestJS starts successfully on port 3001</description>
      <verification>pnpm dev starts server without errors; console shows "Nest application successfully started"</verification>
    </criterion>

    <criterion id="AC8">
      <description>Global validation pipe configured for request validation</description>
      <verification>ValidationPipe configured in main.ts with whitelist: true and forbidNonWhitelisted: true</verification>
    </criterion>

    <criterion id="AC9">
      <description>TypeScript strict mode enabled and type checking passes</description>
      <verification>pnpm build completes successfully with no TypeScript errors</verification>
    </criterion>
  </acceptance-criteria>

  <technical-requirements>
    <requirement category="framework">
      <package>@nestjs/core</package>
      <version>^10.x</version>
      <purpose>Core NestJS framework</purpose>
    </requirement>

    <requirement category="framework">
      <package>@nestjs/common</package>
      <version>^10.x</version>
      <purpose>Common utilities, decorators, guards</purpose>
    </requirement>

    <requirement category="framework">
      <package>@nestjs/platform-express</package>
      <version>^10.x</version>
      <purpose>Express adapter for NestJS</purpose>
    </requirement>

    <requirement category="documentation">
      <package>@nestjs/swagger</package>
      <version>^7.x</version>
      <purpose>OpenAPI/Swagger documentation generation</purpose>
    </requirement>

    <requirement category="configuration">
      <package>@nestjs/config</package>
      <version>^3.x</version>
      <purpose>Environment variable validation and management</purpose>
    </requirement>

    <requirement category="validation">
      <package>class-validator</package>
      <version>Latest</version>
      <purpose>DTO validation decorators</purpose>
    </requirement>

    <requirement category="validation">
      <package>class-transformer</package>
      <version>Latest</version>
      <purpose>Transform plain objects to class instances</purpose>
    </requirement>

    <requirement category="development">
      <package>@nestjs/cli</package>
      <version>^10.x</version>
      <purpose>NestJS CLI for development</purpose>
    </requirement>

    <requirement category="development">
      <package>@nestjs/schematics</package>
      <version>^10.x</version>
      <purpose>Code generation schematics</purpose>
    </requirement>

    <port>3001</port>
    <cors-origin>http://localhost:3000</cors-origin>
    <swagger-path>/api/docs</swagger-path>
    <global-prefix>/api (optional)</global-prefix>
  </technical-requirements>

  <architecture-context>
    <decision ref="ADR-002">
      <title>Hybrid API Architecture</title>
      <summary>Use Next.js API Routes for platform API (auth, workspaces); NestJS for modular business logic</summary>
      <impact>This story creates the NestJS foundation for modular business logic. Platform APIs will be in apps/web/src/app/api</impact>
    </decision>

    <decision ref="ADR-003">
      <title>NestJS for Modular Backend</title>
      <summary>NestJS 10 provides modular architecture with dependency injection, decorators, and built-in support for microservices patterns</summary>
      <impact>Must follow NestJS module pattern: each feature in its own module with controllers, services, DTOs</impact>
    </decision>

    <project-structure>
      apps/api/
      ├── src/
      │   ├── main.ts              # Entry point - configure port, CORS, Swagger, validation pipe
      │   ├── app.module.ts        # Root module - imports CommonModule
      │   ├── app.controller.ts    # Health check controller
      │   ├── app.service.ts       # Health check service
      │   └── common/              # Shared utilities (future)
      │       ├── decorators/
      │       ├── guards/
      │       ├── interceptors/
      │       └── filters/
      ├── test/                    # E2E tests (future)
      ├── nest-cli.json            # NestJS CLI configuration with Swagger plugin
      ├── tsconfig.json            # TypeScript configuration (strict mode)
      ├── .eslintrc.js             # ESLint configuration
      └── package.json             # Dependencies
    </project-structure>

    <service-responsibility>
      apps/api handles modular business logic and WebSocket gateway.
      Receives HTTP/WebSocket requests from frontend.
      Returns JSON responses and events.
      Future modules: approvals, ai-providers, events, websocket.
    </service-responsibility>

    <integration-points>
      <frontend>
        - Next.js frontend at http://localhost:3000
        - Makes HTTP requests to http://localhost:3001
        - CORS must allow localhost:3000 origin
      </frontend>

      <database>
        - Database integration in Story 00-4
        - Will use packages/db Prisma client
      </database>

      <authentication>
        - Authentication in Epic 01
        - Will use JWT from better-auth
      </authentication>
    </integration-points>
  </architecture-context>

  <existing-code-context>
    <monorepo-structure>
      Root package.json manages workspaces: apps/*, packages/*
      Turborepo orchestrates builds and dev servers
      pnpm as package manager (v9.14.4)
      Node.js 20+ required
    </monorepo-structure>

    <completed-stories>
      <story id="00-1">
        Initialize Monorepo with Turborepo - DONE
        Created workspace structure with Turborepo, pnpm workspaces
        Root package.json and turbo.json configured
      </story>

      <story id="00-2">
        Configure Next.js 15 Frontend - DONE
        Frontend running on port 3000
        Tailwind CSS 4 configured
        Dark/light theme support
      </story>
    </completed-stories>

    <current-apps-api-state>
      apps/api/ directory exists with:
      - package.json (placeholder with echo scripts)
      - .gitkeep
      - No actual NestJS code yet

      Current package.json:
      {
        "name": "@hyvve/api",
        "version": "0.1.0",
        "private": true,
        "description": "NestJS 10 backend - configured in Story 00.3",
        "scripts": {
          "dev": "echo 'NestJS configuration in Story 00.3'",
          "build": "echo 'NestJS configuration in Story 00.3'",
          "lint": "echo 'ESLint configuration in Story 00.3'",
          "type-check": "echo 'TypeScript configuration in Story 00.3'"
        }
      }

      This file needs to be completely replaced with proper NestJS configuration.
    </current-apps-api-state>

    <turbo-json>
      {
        "$schema": "https://turbo.build/schema.json",
        "globalDependencies": ["**/.env.*local"],
        "tasks": {
          "build": {
            "dependsOn": ["^build"],
            "outputs": ["dist/**", ".next/**", "build/**"]
          },
          "dev": {
            "cache": false,
            "persistent": true
          },
          "lint": {
            "dependsOn": ["^lint"],
            "outputs": []
          },
          "type-check": {
            "dependsOn": ["^type-check"],
            "outputs": []
          }
        }
      }

      Note: This is already configured for apps/api - no changes needed.
    </turbo-json>

    <root-package-json>
      Scripts available:
      - pnpm dev: Runs turbo dev (starts all apps in parallel)
      - pnpm build: Runs turbo build
      - pnpm lint: Runs turbo lint
      - pnpm type-check: Runs turbo type-check

      packageManager: "pnpm@9.14.4"
      engines: { node: ">=20.0.0", pnpm: ">=9.0.0" }
    </root-package-json>

    <environment-variables>
      From .env.example (relevant for this story):

      # Story 00.4 - Database (not needed yet)
      DATABASE_URL="postgresql://..."
      DIRECT_URL="postgresql://..."

      # Story 00.5 - Redis (not needed yet)
      REDIS_URL="redis://localhost:6379"

      # Epic 01 - Authentication (not needed yet)
      BETTER_AUTH_SECRET="..."

      # Story 00.3 - NestJS configuration
      PORT=3001 (default, can be configured in main.ts)
      NODE_ENV=development
      FRONTEND_URL=http://localhost:3000

      For Story 00.3, minimal env validation needed:
      - PORT (optional, default 3001)
      - NODE_ENV (optional, default development)
      - FRONTEND_URL (required for CORS)
    </environment-variables>

    <related-packages>
      packages/shared:
      - Placeholder for types (Story 00-6)
      - Not needed for Story 00-3

      packages/db:
      - Placeholder for Prisma (Story 00-4)
      - Not needed for Story 00-3

      packages/ui:
      - Shared UI components
      - Not relevant for backend
    </related-packages>
  </existing-code-context>

  <dependencies>
    <npm-packages>
      <production>
        "@nestjs/common": "^10.0.0",
        "@nestjs/core": "^10.0.0",
        "@nestjs/platform-express": "^10.0.0",
        "@nestjs/config": "^3.0.0",
        "@nestjs/swagger": "^7.0.0",
        "class-validator": "^0.14.0",
        "class-transformer": "^0.5.0",
        "reflect-metadata": "^0.2.0",
        "rxjs": "^7.8.0"
      </production>

      <development>
        "@nestjs/cli": "^10.0.0",
        "@nestjs/schematics": "^10.0.0",
        "@nestjs/testing": "^10.0.0",
        "@types/express": "^4.17.0",
        "@types/node": "^20.0.0",
        "@typescript-eslint/eslint-plugin": "^7.0.0",
        "@typescript-eslint/parser": "^7.0.0",
        "eslint": "^9.0.0",
        "eslint-config-prettier": "^9.0.0",
        "eslint-plugin-prettier": "^5.0.0",
        "prettier": "^3.0.0",
        "ts-node": "^10.0.0",
        "tsconfig-paths": "^4.2.0",
        "typescript": "^5.0.0"
      </development>
    </npm-packages>

    <internal-dependencies>
      None for Story 00-3.
      Future stories will add:
      - @hyvve/db (Story 00-4)
      - @hyvve/shared (Story 00-6)
    </internal-dependencies>
  </dependencies>

  <implementation-guide>
    <step number="1">
      <title>Initialize NestJS application structure</title>
      <action>Create src/ directory and basic NestJS files</action>
      <files>
        - src/main.ts
        - src/app.module.ts
        - src/app.controller.ts
        - src/app.service.ts
        - src/app.controller.spec.ts
      </files>
      <notes>Can use @nestjs/cli to generate or create manually. Manual creation preferred to understand structure.</notes>
    </step>

    <step number="2">
      <title>Configure package.json with NestJS dependencies</title>
      <action>Replace placeholder package.json with full NestJS configuration</action>
      <scripts>
        "dev": "nest start --watch",
        "build": "nest build",
        "start": "node dist/main",
        "lint": "eslint \"{src,apps,libs,test}/**/*.ts\" --fix",
        "type-check": "tsc --noEmit",
        "test": "jest",
        "test:watch": "jest --watch",
        "test:cov": "jest --coverage"
      </scripts>
    </step>

    <step number="3">
      <title>Configure nest-cli.json</title>
      <action>Create nest-cli.json with Swagger plugin configuration</action>
      <configuration>
        {
          "collection": "@nestjs/schematics",
          "sourceRoot": "src",
          "compilerOptions": {
            "plugins": ["@nestjs/swagger"],
            "assets": ["**/*.json"],
            "watchAssets": true,
            "deleteOutDir": true
          }
        }
      </configuration>
      <notes>Swagger plugin automatically generates OpenAPI documentation from decorators</notes>
    </step>

    <step number="4">
      <title>Configure TypeScript (tsconfig.json)</title>
      <action>Create tsconfig.json with strict mode enabled</action>
      <strict-checks>
        "strict": true,
        "noImplicitAny": true,
        "strictNullChecks": true,
        "strictFunctionTypes": true,
        "strictBindCallApply": true,
        "strictPropertyInitialization": true,
        "noImplicitThis": true,
        "alwaysStrict": true
      </strict-checks>
      <compiler-options>
        "target": "ES2021",
        "module": "commonjs",
        "moduleResolution": "node",
        "esModuleInterop": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true,
        "experimentalDecorators": true,
        "emitDecoratorMetadata": true,
        "outDir": "./dist",
        "baseUrl": "./",
        "paths": {
          "@/*": ["src/*"]
        }
      </compiler-options>
    </step>

    <step number="5">
      <title>Implement main.ts with all configurations</title>
      <action>Create entry point with port, CORS, Swagger, and validation pipe setup</action>
      <code-pattern>
        import { NestFactory } from '@nestjs/core';
        import { ValidationPipe } from '@nestjs/common';
        import { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';
        import { AppModule } from './app.module';

        async function bootstrap() {
          const app = await NestFactory.create(AppModule);

          // CORS configuration (AC6)
          app.enableCors({
            origin: process.env.FRONTEND_URL || 'http://localhost:3000',
            credentials: true,
          });

          // Global validation pipe (AC8)
          app.useGlobalPipes(
            new ValidationPipe({
              whitelist: true,
              forbidNonWhitelisted: true,
              transform: true,
            }),
          );

          // Swagger configuration (AC3)
          const config = new DocumentBuilder()
            .setTitle('HYVVE Platform API')
            .setDescription('NestJS backend for modular business logic')
            .setVersion('0.1.0')
            .build();
          const document = SwaggerModule.createDocument(app, config);
          SwaggerModule.setup('api/docs', app, document);

          // Start server (AC7)
          const port = process.env.PORT || 3001;
          await app.listen(port);
          console.log(`NestJS application running on http://localhost:${port}`);
          console.log(`Swagger documentation: http://localhost:${port}/api/docs`);
        }
        bootstrap();
      </code-pattern>
    </step>

    <step number="6">
      <title>Configure environment validation</title>
      <action>Set up ConfigModule with validation schema</action>
      <validation-schema>
        Use class-validator to define EnvironmentVariables class:
        - PORT: number (optional, default 3001)
        - NODE_ENV: 'development' | 'production' | 'test' (optional, default development)
        - FRONTEND_URL: string (required)

        ConfigModule.forRoot({
          isGlobal: true,
          validate: (config) =&gt; validateSync(config),
        })
      </validation-schema>
      <notes>Environment validation ensures application fails fast if required variables missing (AC4)</notes>
    </step>

    <step number="7">
      <title>Implement health check endpoint</title>
      <action>Create AppController with GET /health endpoint</action>
      <response-format>
        {
          "status": "ok",
          "timestamp": "2025-12-01T12:00:00.000Z"
        }
      </response-format>
      <swagger-decorators>
        @ApiOperation({ summary: 'Health check endpoint' })
        @ApiResponse({ status: 200, description: 'Service is healthy' })
      </swagger-decorators>
      <notes>This endpoint will be used for Docker health checks in Story 00-5</notes>
    </step>

    <step number="8">
      <title>Create AppModule with basic structure</title>
      <action>Set up root module importing ConfigModule</action>
      <module-structure>
        @Module({
          imports: [
            ConfigModule.forRoot({ ... }),
          ],
          controllers: [AppController],
          providers: [AppService],
        })
      </module-structure>
      <notes>Future stories will add more modules: auth, approvals, ai-providers, events</notes>
    </step>

    <step number="9">
      <title>Configure ESLint and Prettier</title>
      <action>Create .eslintrc.js and .prettierrc for code quality</action>
      <eslint-config>
        Extend @nestjs/eslint-config
        Enable TypeScript rules
        Configure Prettier integration
      </eslint-config>
    </step>

    <step number="10">
      <title>Create .env.example for apps/api</title>
      <action>Document required environment variables</action>
      <variables>
        PORT=3001
        NODE_ENV=development
        FRONTEND_URL=http://localhost:3000
      </variables>
      <notes>This is a subset of the root .env.example, specific to apps/api</notes>
    </step>

    <step number="11">
      <title>Test development server</title>
      <action>Run pnpm dev from root and verify NestJS starts</action>
      <verification>
        - Server starts without errors
        - Console shows "NestJS application running on http://localhost:3001"
        - Console shows Swagger documentation URL
      </verification>
    </step>

    <step number="12">
      <title>Test all acceptance criteria</title>
      <action>Manual testing of each AC</action>
      <tests>
        AC1: Verify directory structure
        AC2: Verify modules configured
        AC3: Load http://localhost:3001/api/docs in browser
        AC4: Remove FRONTEND_URL from .env and verify startup fails
        AC5: curl http://localhost:3001/health
        AC6: Make request from Next.js frontend to backend
        AC7: Check console logs for successful startup
        AC8: Inspect main.ts for ValidationPipe configuration
        AC9: Run pnpm build and verify no TypeScript errors
      </tests>
    </step>
  </implementation-guide>

  <file-changes-expected>
    <new-files>
      apps/api/src/main.ts
      apps/api/src/app.module.ts
      apps/api/src/app.controller.ts
      apps/api/src/app.service.ts
      apps/api/src/app.controller.spec.ts
      apps/api/nest-cli.json
      apps/api/tsconfig.json
      apps/api/tsconfig.build.json
      apps/api/.eslintrc.js
      apps/api/.prettierrc
      apps/api/.env.example
      apps/api/README.md (optional)
    </new-files>

    <modified-files>
      apps/api/package.json (complete replacement)
    </modified-files>

    <deleted-files>
      apps/api/.gitkeep (no longer needed)
    </deleted-files>

    <no-changes>
      turbo.json (already configured)
      Root package.json (no changes needed)
      apps/web/* (no changes needed)
      packages/* (no changes needed)
    </no-changes>
  </file-changes-expected>

  <testing-requirements>
    <manual-tests>
      <test id="1">
        <name>Startup Test</name>
        <steps>
          1. cd apps/api
          2. pnpm install
          3. pnpm dev
        </steps>
        <expected>Server starts on port 3001 without errors</expected>
      </test>

      <test id="2">
        <name>Health Check Test</name>
        <command>curl http://localhost:3001/health</command>
        <expected>{"status":"ok","timestamp":"2025-12-01T..."}</expected>
      </test>

      <test id="3">
        <name>Swagger UI Test</name>
        <steps>
          1. Open browser
          2. Navigate to http://localhost:3001/api/docs
        </steps>
        <expected>Swagger UI loads with health endpoint documented</expected>
      </test>

      <test id="4">
        <name>CORS Test</name>
        <steps>
          1. Start Next.js frontend (pnpm dev from root)
          2. Make API request from frontend to backend
          3. Check browser console
        </steps>
        <expected>Request succeeds without CORS errors</expected>
      </test>

      <test id="5">
        <name>Environment Validation Test</name>
        <steps>
          1. Remove FRONTEND_URL from .env.local
          2. Try to start NestJS application
        </steps>
        <expected>Application fails to start with validation error message</expected>
      </test>

      <test id="6">
        <name>Type Checking Test</name>
        <command>pnpm build</command>
        <expected>Build completes successfully with no TypeScript errors</expected>
      </test>

      <test id="7">
        <name>Lint Test</name>
        <command>pnpm lint</command>
        <expected>No linting errors</expected>
      </test>

      <test id="8">
        <name>Turbo Integration Test</name>
        <steps>
          1. From root directory: pnpm dev
          2. Verify both apps/web and apps/api start
        </steps>
        <expected>Both applications start in parallel via Turborepo</expected>
      </test>
    </manual-tests>

    <edge-cases>
      <case>Missing environment variables cause startup failure with clear error message</case>
      <case>Invalid environment variable values are rejected</case>
      <case>Port already in use is handled gracefully with error message</case>
      <case>Health check returns current timestamp in ISO 8601 format</case>
      <case>Swagger plugin correctly generates OpenAPI documentation from decorators</case>
      <case>CORS only allows specified origin (localhost:3000), not others</case>
      <case>Validation pipe rejects requests with extra fields when forbidNonWhitelisted is true</case>
    </edge-cases>

    <unit-tests>
      AppController unit test (app.controller.spec.ts):
      - Should return health check response with status 'ok'
      - Should return health check response with ISO timestamp

      Note: Full test suite not required for this story.
      Jest configuration and testing will be expanded in future stories.
    </unit-tests>
  </testing-requirements>

  <nfr-requirements>
    <performance>
      - NestJS startup time: &lt; 5 seconds
      - Health check response time: &lt; 50ms
      - Cold start with pnpm dev: &lt; 30 seconds (monorepo-wide)
    </performance>

    <security>
      - No secrets in code or repository
      - All configuration via environment variables
      - CORS restricted to specified origins only
      - Validation pipe prevents unexpected fields in requests
    </security>

    <observability>
      - NestJS built-in logger enabled
      - Console logs for successful startup
      - Clear error messages for validation failures
      - Swagger documentation for API discoverability
    </observability>

    <maintainability>
      - TypeScript strict mode enabled
      - ESLint and Prettier configured
      - Modular structure (separation of concerns)
      - Clear naming conventions followed
    </maintainability>
  </nfr-requirements>

  <anti-patterns-to-avoid>
    <anti-pattern>
      <name>Hardcoded configuration values</name>
      <why>Makes environment-specific deployment difficult</why>
      <instead>Use ConfigModule and environment variables</instead>
    </anti-pattern>

    <anti-pattern>
      <name>Disabling TypeScript strict mode</name>
      <why>Reduces type safety and increases bugs</why>
      <instead>Keep strict: true and fix type errors</instead>
    </anti-pattern>

    <anti-pattern>
      <name>Allowing all CORS origins with '*'</name>
      <why>Security vulnerability</why>
      <instead>Explicitly specify allowed origins</instead>
    </anti-pattern>

    <anti-pattern>
      <name>No input validation</name>
      <why>Allows malformed requests to reach business logic</why>
      <instead>Use global ValidationPipe with class-validator</instead>
    </anti-pattern>

    <anti-pattern>
      <name>Putting business logic in controllers</name>
      <why>Violates separation of concerns, hard to test</why>
      <instead>Keep controllers thin, delegate to services</instead>
    </anti-pattern>

    <anti-pattern>
      <name>Not using DTOs for request/response</name>
      <why>Loses type safety and documentation</why>
      <instead>Define DTOs with class-validator decorators</instead>
    </anti-pattern>
  </anti-patterns-to-avoid>

  <reference-materials>
    <documentation>
      <doc>
        <title>NestJS Official Documentation</title>
        <url>https://docs.nestjs.com/</url>
        <sections>First Steps, Controllers, Providers, Modules, Middleware, Pipes, Guards</sections>
      </doc>

      <doc>
        <title>NestJS OpenAPI (Swagger)</title>
        <url>https://docs.nestjs.com/openapi/introduction</url>
        <sections>CLI Plugin, Decorators, Types and Parameters</sections>
      </doc>

      <doc>
        <title>NestJS Configuration</title>
        <url>https://docs.nestjs.com/techniques/configuration</url>
        <sections>Installation, Custom env file path, Configuration namespaces, Schema validation</sections>
      </doc>

      <doc>
        <title>class-validator Documentation</title>
        <url>https://github.com/typestack/class-validator</url>
        <sections>Validation decorators, Validation options</sections>
      </doc>
    </documentation>

    <internal-docs>
      <doc>Tech Spec: docs/archive/foundation-phase/sprint-artifacts/tech-spec-epic-00.md (Section: AC-00.3)</doc>
      <doc>Architecture: docs/architecture.md (ADR-003: NestJS for Modular Backend)</doc>
      <doc>Epic File: docs/epics/EPIC-00-project-scaffolding.md</doc>
      <doc>Story File: docs/archive/foundation-phase/sprint-artifacts/story-00-3-configure-nestjs-backend.md</doc>
    </internal-docs>
  </reference-materials>

  <success-criteria>
    <must-have>
      ✓ All 9 acceptance criteria met
      ✓ NestJS starts without errors on port 3001
      ✓ Health check endpoint returns correct response
      ✓ Swagger UI accessible and displays documentation
      ✓ CORS configured correctly
      ✓ Environment validation working
      ✓ TypeScript type checking passes
      ✓ ESLint passes with no errors
      ✓ Integration with monorepo (Turborepo) verified
    </must-have>

    <nice-to-have>
      - Unit test for AppController health check
      - README.md with setup instructions
      - Logger configuration
      - Request correlation ID middleware
    </nice-to-have>

    <definition-of-done>
      All acceptance criteria met
      NestJS application starts without errors on port 3001
      Health check endpoint responds with 200 OK and correct payload
      Swagger UI accessible and displays health check endpoint documentation
      CORS configured correctly (tested with frontend origin)
      Environment validation rejects missing required variables
      TypeScript type checking passes (tsc --noEmit)
      Code follows project coding standards (ESLint/Prettier)
      No console errors or warnings during startup
      Integration verified with existing monorepo structure (Story 00-1)
      Documentation updated (if needed)
    </definition-of-done>
  </success-criteria>

  <notes>
    <note>This story focuses on NestJS scaffolding ONLY - no business logic or database connections yet</note>
    <note>Database integration will be handled in Story 00-4 (Database Package with Prisma)</note>
    <note>Authentication will be implemented in Epic 01</note>
    <note>Keep the implementation minimal - only what's specified in acceptance criteria</note>
    <note>Follow existing patterns from the monorepo structure established in Story 00-1</note>
    <note>Ensure all configuration is environment-based (no hardcoded values)</note>
    <note>The apps/api directory currently has only a placeholder package.json - everything needs to be created</note>
    <note>Turborepo is already configured to handle apps/api - no changes to turbo.json needed</note>
  </notes>
</story-context>
