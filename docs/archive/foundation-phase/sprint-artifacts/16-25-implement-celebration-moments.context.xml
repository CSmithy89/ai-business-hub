<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>16</epicId>
    <storyId>25</storyId>
    <title>Implement Celebration Moments</title>
    <status>drafted</status>
    <generatedAt>2025-12-13</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/archive/foundation-phase/sprint-artifacts/16-25-implement-celebration-moments.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user completing important milestones</asA>
    <iWant>celebration feedback through animations</iWant>
    <soThat>achievements feel rewarding and the platform feels delightful</soThat>
    <tasks>
      <task n="1" title="Install canvas-confetti Library" ac="1">
        <subtask>Run pnpm add canvas-confetti in apps/web</subtask>
        <subtask>Add @types/canvas-confetti for TypeScript</subtask>
      </task>
      <task n="2" title="Create Confetti Component" ac="1,5">
        <subtask>Create apps/web/src/components/ui/confetti.tsx</subtask>
        <subtask>Implement dual-origin confetti burst (left + right sides)</subtask>
        <subtask>Add brand color palette</subtask>
        <subtask>Implement prefers-reduced-motion check</subtask>
        <subtask>Add onComplete callback prop</subtask>
      </task>
      <task n="3" title="Create Badge Celebration Modal" ac="2,5">
        <subtask>Create apps/web/src/components/ui/badge-celebration.tsx</subtask>
        <subtask>Use CSS animations (framer-motion NOT installed)</subtask>
        <subtask>Include icon slot, title, description, dismiss button</subtask>
        <subtask>Dark backdrop overlay using Radix Dialog</subtask>
        <subtask>Focus trap and keyboard dismiss (Escape key)</subtask>
      </task>
      <task n="4" title="Create Character Celebration Component" ac="3">
        <subtask>Create apps/web/src/components/ui/celebration-message.tsx</subtask>
        <subtask>Accept character prop (Hub, Maya, Atlas, Nova, Echo)</subtask>
        <subtask>Subtle fade-in and bounce animation via CSS</subtask>
        <subtask>Use Lucide icons as character representations</subtask>
      </task>
      <task n="5" title="Create Animated Checkmark Component" ac="4,5">
        <subtask>Create apps/web/src/components/ui/animated-checkmark.tsx</subtask>
        <subtask>CSS/SVG animation for circular progress + checkmark</subtask>
        <subtask>Green color (#2ECC71)</subtask>
        <subtask>Auto-complete after 1 second</subtask>
      </task>
      <task n="6" title="Create useCelebration Hook" ac="6">
        <subtask>Create apps/web/src/hooks/use-celebration.ts</subtask>
        <subtask>Manage celebration state (type, active, onComplete)</subtask>
        <subtask>Export celebrate(type) function</subtask>
        <subtask>Support multiple celebration types</subtask>
        <subtask>Export hook in apps/web/src/hooks/index.ts</subtask>
      </task>
      <task n="7" title="Integrate Celebrations into Existing Components" ac="1,2,3,4">
        <subtask>Add confetti to onboarding wizard completion (StepComplete.tsx)</subtask>
        <subtask>Add confetti to first business creation</subtask>
        <subtask>Add badge celebration for first approvals/tasks</subtask>
        <subtask>Enhance empty-state.tsx celebration prop integration</subtask>
        <subtask>Add checkmark to settings save confirmations</subtask>
      </task>
      <task n="8" title="Testing" ac="all">
        <subtask>Unit tests for useCelebration hook</subtask>
        <subtask>Visual test for reduced-motion behavior</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1" title="Confetti Animation Component">
      <item>Create Confetti component using canvas-confetti library</item>
      <item>Confetti triggers on: completing onboarding wizard, first business creation, validation score reaching 80%+</item>
      <item>Confetti uses brand colors (coral #FF6B6B, blue #4B7BEC, teal #20B2AA, orange #FF9F43, green #2ECC71)</item>
      <item>Animation duration: 2-3 seconds</item>
      <item>Confetti originates from both sides of screen</item>
    </criterion>
    <criterion id="2" title="Badge/Achievement Animation">
      <item>Create BadgeCelebration modal component with CSS animations</item>
      <item>Badge appears on first task completion (first approval, first business, etc.)</item>
      <item>Scale-in animation with overlay backdrop</item>
      <item>"Awesome!" dismiss button</item>
    </criterion>
    <criterion id="3" title="Character Celebration States">
      <item>Create CelebrationMessage component for inline celebrations</item>
      <item>Show character celebration when: approval queue is empty, all notifications read</item>
      <item>Subtle animation (fade in, slight bounce)</item>
    </criterion>
    <criterion id="4" title="Checkmark Success Animation">
      <item>Create animated checkmark component</item>
      <item>Triggers on: successful form submission, settings saved</item>
      <item>Green checkmark with circular progress/completion effect</item>
      <item>Duration: 1 second</item>
    </criterion>
    <criterion id="5" title="Accessibility and Performance">
      <item>Respect prefers-reduced-motion media query (skip animations)</item>
      <item>All animations should be brief (1-3 seconds max)</item>
      <item>No animations should block user interaction</item>
      <item>Cleanup canvas/elements after animation completes</item>
    </criterion>
    <criterion id="6" title="useCelebration Hook">
      <item>Create reusable hook for triggering celebrations</item>
      <item>Expose celebrate() function and celebrating state</item>
      <item>Support different celebration types: confetti, badge, checkmark, character</item>
      <item>Provide onComplete callback</item>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/archive/foundation-phase/sprint-artifacts/tech-spec-epic-16.md" title="Epic 16 Tech Spec" section="Story 16.25">
        Detailed implementation specs for Confetti component, BadgeCelebration modal, and useCelebration hook with code examples.
      </doc>
      <doc path="docs/epics/EPIC-16-premium-polish-advanced-features.md" title="Epic 16 Definition" section="Story 16.25">
        Acceptance criteria and file locations for celebration components.
      </doc>
      <doc path="docs/ux-design.md" title="UX Design Document" section="Design Philosophy">
        Micro-Delight principle: Celebration moments, smooth animations. Speed as Feature: 100ms interactions.
      </doc>
    </docs>
    <code>
      <file path="apps/web/src/components/layout/PageTransition.tsx" kind="component" reason="Pattern for reduced-motion handling and CSS animation approach">
        Demonstrates how to check prefers-reduced-motion and use CSS keyframe animations.
      </file>
      <file path="apps/web/src/components/ui/empty-state.tsx" kind="component" reason="Has celebration prop ready for integration" lines="43,122,150,167">
        Already has celebration boolean prop and Sparkles icon. Can be enhanced with confetti integration.
      </file>
      <file path="apps/web/src/app/globals.css" kind="styles" reason="CSS animation patterns and reduced-motion media queries" lines="244,379,427,670,738">
        Contains @keyframes definitions (page-enter, pulse-dot), hover-lift, press-feedback classes, and @media (prefers-reduced-motion) rules.
      </file>
      <file path="apps/web/src/hooks/index.ts" kind="exports" reason="Hook export pattern for new use-celebration.ts">
        Add export for useCelebration hook following existing pattern.
      </file>
      <file path="apps/web/src/components/onboarding/account/StepComplete.tsx" kind="component" reason="Integration point for onboarding completion confetti">
        Account setup completion step - add confetti celebration here.
      </file>
      <file path="apps/web/src/components/onboarding/WizardStepConfirm.tsx" kind="component" reason="Integration point for business wizard completion confetti">
        Business onboarding confirmation step.
      </file>
    </code>
    <dependencies>
      <node>
        <package name="canvas-confetti" version="to-install" note="Required for confetti animation"/>
        <package name="@types/canvas-confetti" version="to-install" note="TypeScript types"/>
        <package name="@radix-ui/react-dialog" version="^1.1.15" note="For badge celebration modal"/>
        <package name="lucide-react" version="^0.263.0" note="Icons for character representations"/>
        <package name="clsx" version="^2.1.0" note="Class name utility"/>
        <package name="class-variance-authority" version="^0.7.1" note="Variant styling"/>
      </node>
      <note>framer-motion is NOT installed - use CSS animations instead</note>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="pattern">Follow PageTransition.tsx pattern for animation handling and reduced-motion support</constraint>
    <constraint type="pattern">Use CSS @keyframes animations instead of framer-motion (not installed)</constraint>
    <constraint type="pattern">UI components go in apps/web/src/components/ui/</constraint>
    <constraint type="pattern">Custom hooks go in apps/web/src/hooks/ and must be exported from index.ts</constraint>
    <constraint type="accessibility">Respect prefers-reduced-motion media query - skip all animations</constraint>
    <constraint type="accessibility">Use @media (prefers-reduced-motion: reduce) in globals.css for new animations</constraint>
    <constraint type="performance">Canvas-confetti handles cleanup automatically via default overlay</constraint>
    <constraint type="zindex">Celebrations should appear above all content (z-50+)</constraint>
    <constraint type="timing">Animation durations: confetti 2-3s, badge modal 150ms enter, checkmark 1s</constraint>
  </constraints>

  <interfaces>
    <interface name="ConfettiProps" kind="component-props" path="apps/web/src/components/ui/confetti.tsx">
      interface ConfettiProps {
        trigger: boolean;
        onComplete?: () => void;
        colors?: string[];
        duration?: number;
      }
    </interface>
    <interface name="BadgeCelebrationProps" kind="component-props" path="apps/web/src/components/ui/badge-celebration.tsx">
      interface BadgeCelebrationProps {
        show: boolean;
        badge: { icon: React.ReactNode; title: string; description: string; };
        onClose: () => void;
      }
    </interface>
    <interface name="useCelebration" kind="hook-return" path="apps/web/src/hooks/use-celebration.ts">
      interface UseCelebrationReturn {
        celebrating: boolean;
        celebrationType: 'confetti' | 'badge' | 'checkmark' | 'character' | null;
        celebrate: (type: CelebrationType) => void;
        onComplete: () => void;
        Confetti: React.FC; // Render component
      }
    </interface>
    <interface name="EmptyStateProps.celebration" kind="existing-prop" path="apps/web/src/components/ui/empty-state.tsx">
      celebration?: boolean; // Already exists at line 122 - enhance to trigger confetti
    </interface>
  </interfaces>

  <tests>
    <standards>
      Tests use Vitest and React Testing Library. Follow existing test patterns in apps/web.
      Mock window.matchMedia for prefers-reduced-motion tests.
      Use jest.useFakeTimers for animation timing tests.
    </standards>
    <locations>
      apps/web/src/hooks/__tests__/
      apps/web/src/components/ui/__tests__/
    </locations>
    <ideas>
      <test ac="1">Test confetti triggers with correct colors and dual-origin</test>
      <test ac="1">Test confetti cleanup after duration completes</test>
      <test ac="5">Test reduced-motion skips confetti animation and calls onComplete immediately</test>
      <test ac="2">Test badge modal renders with correct content and dismisses on button click</test>
      <test ac="2">Test badge modal closes on Escape key press</test>
      <test ac="6">Test useCelebration hook state transitions</test>
      <test ac="6">Test celebrate() triggers correct celebration type</test>
      <test ac="4">Test animated checkmark completes after 1 second</test>
    </ideas>
  </tests>
</story-context>
