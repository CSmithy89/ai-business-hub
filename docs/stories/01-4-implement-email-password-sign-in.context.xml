<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <metadata>
    <story-id>01-4</story-id>
    <story-title>Implement Email/Password Sign-In</story-title>
    <epic-id>EPIC-01</epic-id>
    <epic-title>Authentication System</epic-title>
    <generated-date>2025-12-02</generated-date>
    <status>ready-for-dev</status>
    <priority>P0</priority>
    <points>2</points>
  </metadata>

  <!-- ============================================== -->
  <!-- STORY OVERVIEW -->
  <!-- ============================================== -->
  <story-overview>
    <user-story>
      <as-a>registered user</as-a>
      <i-want>to sign in with my email and password</i-want>
      <so-that>I can access my account</so-that>
    </user-story>

    <business-value>
      Enables existing users to authenticate and access the platform securely. This is a critical
      path feature that must be reliable, fast (target &lt; 300ms p95), and secure against attacks.
    </business-value>

    <dependencies>
      <dependency status="done">Story 01.1: Install and Configure better-auth</dependency>
      <dependency status="done">Story 01.2: Implement Email/Password Registration</dependency>
      <dependency status="done">Story 01.3: Implement Email Verification</dependency>
    </dependencies>

    <blocks>
      <story>Story 01.5: Implement Google OAuth - Google sign-in button will be made functional</story>
      <story>Story 01.7: Implement Session Management - Will extend session functionality</story>
    </blocks>
  </story-overview>

  <!-- ============================================== -->
  <!-- ACCEPTANCE CRITERIA -->
  <!-- ============================================== -->
  <acceptance-criteria>
    <criterion id="AC-1">
      <description>Create sign-in page at /sign-in</description>
      <testable>Given user navigates to /sign-in, when page loads, then sign-in form is displayed with all required fields</testable>
    </criterion>

    <criterion id="AC-2">
      <description>Validate credentials against database</description>
      <testable>Given valid email and password, when submitting form, then credentials are validated using Argon2id hash comparison</testable>
    </criterion>

    <criterion id="AC-3">
      <description>Create session in database</description>
      <testable>Given valid credentials, when sign-in succeeds, then session record created in database with correct expiry</testable>
    </criterion>

    <criterion id="AC-4">
      <description>Set session token in HTTP-only cookie</description>
      <testable>Given successful sign-in, when response received, then HTTP-only cookie set with secure flags</testable>
    </criterion>

    <criterion id="AC-5">
      <description>Redirect to dashboard on success</description>
      <testable>Given successful sign-in, when session created, then user redirected to /dashboard</testable>
    </criterion>

    <criterion id="AC-6">
      <description>Show appropriate error for invalid credentials</description>
      <testable>Given wrong email or password, when submitting, then generic "Invalid credentials" error shown (no user enumeration)</testable>
    </criterion>

    <criterion id="AC-7">
      <description>Rate limit: 5 attempts per 15 minutes</description>
      <testable>Given 5 failed sign-in attempts, when attempting 6th, then rate limit error shown with retry-after countdown</testable>
    </criterion>

    <criterion id="AC-8">
      <description>Display email input with validation</description>
      <testable>Given invalid email format, when submitting, then validation error displayed inline</testable>
    </criterion>

    <criterion id="AC-9">
      <description>Display password input with show/hide toggle</description>
      <testable>Given password entered, when clicking eye icon, then password visibility toggles between hidden and visible</testable>
    </criterion>

    <criterion id="AC-10">
      <description>Implement "Remember me" checkbox (extends session to 30 days)</description>
      <testable>Given "Remember me" checked, when signing in, then session expiry set to 30 days instead of 7</testable>
    </criterion>

    <criterion id="AC-11">
      <description>Provide "Forgot password" link</description>
      <testable>Given "Forgot password" link visible, when clicked, then navigates to password reset page</testable>
    </criterion>

    <criterion id="AC-12">
      <description>Show loading state on sign-in button during submission</description>
      <testable>Given form submitted, when processing, then button shows spinner and "Signing in..." text with disabled state</testable>
    </criterion>

    <criterion id="AC-13">
      <description>Block sign-in for unverified users with clear message</description>
      <testable>Given unverified user credentials, when signing in, then "Email not verified" error shown with resend option</testable>
    </criterion>

    <criterion id="AC-14">
      <description>Show Google OAuth option (button only, functionality in Story 01.5)</description>
      <testable>Given sign-in page loaded, when viewing, then "Continue with Google" button visible but disabled or shows "Coming soon"</testable>
    </criterion>
  </acceptance-criteria>

  <!-- ============================================== -->
  <!-- TECHNICAL ARCHITECTURE -->
  <!-- ============================================== -->
  <technical-architecture>
    <authentication-flow>
      <step order="1">User enters email and password</step>
      <step order="2">Client-side validation (email format, password not empty)</step>
      <step order="3">Submit to better-auth sign-in endpoint: POST /api/auth/sign-in/email</step>
      <step order="4">Server validates credentials (Argon2id hash comparison)</step>
      <step order="5">Check user emailVerified status</step>
      <step order="6">Create session record in database</step>
      <step order="7">Set session token in HTTP-only cookie</step>
      <step order="8">Return user data and session info</step>
      <step order="9">Client redirects to /dashboard</step>
    </authentication-flow>

    <session-configuration>
      <access-token>
        <expires-in>900</expires-in><!-- 15 minutes -->
        <comment>Short-lived JWT token for API requests</comment>
      </access-token>
      <session>
        <default-expiry>604800</default-expiry><!-- 7 days -->
        <remember-me-expiry>2592000</remember-me-expiry><!-- 30 days -->
        <update-age>86400</update-age><!-- 24 hours - daily refresh -->
        <cookie>
          <http-only>true</http-only>
          <secure>true</secure><!-- Only in production -->
          <same-site>lax</same-site>
          <name>hyvve.session</name>
        </cookie>
      </session>
    </session-configuration>

    <api-endpoints>
      <endpoint>
        <path>/api/auth/sign-in/email</path>
        <method>POST</method>
        <provided-by>better-auth (automatic)</provided-by>
        <request>
          <field name="email" type="string" required="true">User's email address</field>
          <field name="password" type="string" required="true">User's password</field>
          <field name="rememberMe" type="boolean" required="false">Extends session to 30 days if true</field>
        </request>
        <response-success>
          <user>
            <field name="id" type="string">User ID (UUID)</field>
            <field name="email" type="string">User's email</field>
            <field name="name" type="string">User's full name</field>
            <field name="emailVerified" type="boolean">Email verification status</field>
            <field name="image" type="string" optional="true">User avatar URL</field>
          </user>
          <session>
            <field name="id" type="string">Session ID</field>
            <field name="token" type="string">Session token</field>
            <field name="expiresAt" type="string">ISO 8601 expiry timestamp</field>
          </session>
        </response-success>
        <response-error>
          <field name="error" type="enum">INVALID_CREDENTIALS | EMAIL_NOT_VERIFIED | RATE_LIMITED</field>
          <field name="message" type="string">Human-readable error message</field>
          <field name="retryAfter" type="number" optional="true">Seconds until next allowed attempt</field>
        </response-error>
      </endpoint>

      <endpoint>
        <path>/api/auth/session</path>
        <method>GET</method>
        <provided-by>better-auth (automatic)</provided-by>
        <purpose>Get current user session</purpose>
        <response>
          <user>
            <field name="id" type="string">User ID</field>
            <field name="email" type="string">User email</field>
            <field name="name" type="string">User name</field>
            <field name="emailVerified" type="boolean">Verification status</field>
            <field name="image" type="string" optional="true">Avatar URL</field>
          </user>
          <session>
            <field name="id" type="string">Session ID</field>
            <field name="expiresAt" type="string">Expiry timestamp</field>
            <field name="activeWorkspaceId" type="string" optional="true">Active workspace (Epic 02)</field>
          </session>
        </response>
      </endpoint>
    </api-endpoints>

    <security-requirements>
      <rate-limiting>
        <implementation>Redis-backed or in-memory store (reuse existing rate-limit.ts)</implementation>
        <limit>5 sign-in attempts per 15 minutes per IP address</limit>
        <response>HTTP 429 with retryAfter timestamp</response>
        <key-format>signin:{ipAddress}</key-format>
        <window>900</window><!-- 15 minutes in seconds -->
      </rate-limiting>

      <password-security>
        <hashing>Argon2id (better-auth default)</hashing>
        <comparison>Timing-safe comparison to prevent timing attacks</comparison>
        <logging>No password exposed in logs or error messages</logging>
      </password-security>

      <session-security>
        <http-only>true</http-only><!-- Prevents XSS attacks -->
        <secure>true</secure><!-- HTTPS only in production -->
        <same-site>lax</same-site><!-- CSRF protection -->
        <token-generation>Cryptographically secure random (32 bytes)</token-generation>
      </session-security>

      <input-validation>
        <email>Valid email format using Zod validation</email>
        <password>Not empty (minimum 1 character for sign-in)</password>
        <sanitization>Sanitize inputs to prevent injection attacks</sanitization>
      </input-validation>

      <error-messages>
        <strategy>Generic "Invalid credentials" for both wrong email and wrong password to prevent user enumeration</strategy>
        <exception>"Email not verified" only shown after successful credential validation</exception>
      </error-messages>
    </security-requirements>

    <database-operations>
      <session-creation>
        <table>sessions</table>
        <operation>
          <description>better-auth automatically creates session on successful sign-in</description>
          <fields>
            <field name="userId">User ID from validated credentials</field>
            <field name="token">Secure random token (32 bytes)</field>
            <field name="expiresAt">Calculated from rememberMe flag (7 or 30 days)</field>
            <field name="ipAddress">Request IP address for security tracking</field>
            <field name="userAgent">Browser/device info for session management</field>
            <field name="activeWorkspaceId">null initially, set in Epic 02</field>
          </fields>
        </operation>
      </session-creation>

      <credential-validation>
        <table>users</table>
        <operation>
          <description>Find user by email and verify password hash</description>
          <steps>
            <step>Find user by email (case-insensitive)</step>
            <step>Check if user exists and has passwordHash</step>
            <step>Verify password using Argon2id (better-auth handles this)</step>
            <step>Check emailVerified field</step>
            <step>Return user data or throw appropriate error</step>
          </steps>
          <errors>
            <error code="INVALID_CREDENTIALS">User not found or password mismatch</error>
            <error code="EMAIL_NOT_VERIFIED">Credentials valid but emailVerified = false</error>
          </errors>
        </operation>
      </credential-validation>
    </database-operations>
  </technical-architecture>

  <!-- ============================================== -->
  <!-- UI/UX SPECIFICATIONS -->
  <!-- ============================================== -->
  <ui-specifications>
    <wireframe>
      <id>AU-01</id>
      <title>Login Page</title>
      <location>docs/design/wireframes/Finished wireframes and html files/au-01_login_page/</location>
      <assets>
        <html>code.html</html>
        <screenshot>screen.png</screenshot>
      </assets>
    </wireframe>

    <page-layout>
      <route>/sign-in</route>
      <structure>Two-column layout (40/60 split on desktop, single column on mobile)</structure>

      <left-panel visibility="hidden on mobile">
        <background-color>#FF6B6B (primary color)</background-color>
        <content>
          <logo>HYVVE logo with honeycomb + text</logo>
          <heading>Your AI-powered business hub</heading>
          <tagline>Streamline operations, boost productivity, and drive growth with a unified suite of intelligent agents.</tagline>
          <features>
            <feature icon="check_circle">6 AI agents</feature>
            <feature icon="check_circle">Smart automation</feature>
            <feature icon="check_circle">Team collaboration</feature>
          </features>
        </content>
      </left-panel>

      <right-panel>
        <width>full on mobile, 60% on desktop</width>
        <max-width>max-w-md (centered)</max-width>
        <content>
          <heading>Welcome back</heading>
          <subheading>Sign in to your account</subheading>

          <social-buttons>
            <button provider="google" status="non-functional">
              <label>Continue with Google</label>
              <icon>Google logo</icon>
              <behavior>Disabled or shows "Coming soon" message</behavior>
            </button>
            <button provider="microsoft" status="non-functional">
              <label>Continue with Microsoft</label>
              <icon>Microsoft logo</icon>
              <behavior>Disabled with "Coming soon" tooltip</behavior>
            </button>
          </social-buttons>

          <divider>OR (with horizontal lines)</divider>

          <form>
            <email-input>
              <label>Email</label>
              <placeholder>you@company.com</placeholder>
              <validation>Real-time email format validation</validation>
            </email-input>

            <password-input>
              <label>Password</label>
              <placeholder>Enter your password</placeholder>
              <toggle>Eye icon for show/hide password</toggle>
              <forgot-link position="top-right">Forgot password?</forgot-link>
            </password-input>

            <remember-me>
              <checkbox>Remember me</checkbox>
              <effect>Extends session to 30 days</effect>
            </remember-me>

            <submit-button>
              <default-text>Sign In</default-text>
              <loading-text>Signing in...</loading-text>
              <loading-icon>Spinner</loading-icon>
              <style>Primary color (#FF6B6B), full width</style>
            </submit-button>
          </form>

          <footer>
            <text>Don't have an account?</text>
            <link href="/sign-up">Sign up</link>
          </footer>
        </content>
      </right-panel>
    </page-layout>

    <form-validation>
      <client-side>
        <email>
          <rule>Valid email format (name@domain.com)</rule>
          <feedback>Real-time validation with red border + error text</feedback>
        </email>
        <password>
          <rule>Not empty</rule>
          <feedback>Red border if empty on submit</feedback>
        </password>
        <submit-disabled>Form submit disabled until all validations pass</submit-disabled>
      </client-side>

      <error-display>
        <field-level>Inline errors below each field (red border + red text)</field-level>
        <form-level>Alert banner at top of form for authentication errors</form-level>
        <loading>All inputs disabled during submission to prevent double-submit</loading>
        <clear-on-change>Error messages clear when field value changes</clear-on-change>
      </error-display>
    </form-validation>

    <loading-states>
      <sign-in-button>
        <default>Sign In</default>
        <loading>
          <icon>Spinner (rotating)</icon>
          <text>Signing in...</text>
          <disabled>true</disabled>
        </loading>
      </sign-in-button>
      <form-inputs>
        <disabled-during-submit>true</disabled-during-submit>
        <prevent-double-submit>true</prevent-double-submit>
      </form-inputs>
    </loading-states>

    <error-states>
      <invalid-credentials>
        <type>Alert banner (red)</type>
        <position>Top of form</position>
        <message>Invalid email or password. Please try again.</message>
        <icon>Error circle</icon>
      </invalid-credentials>

      <email-not-verified>
        <type>Alert banner (yellow/warning)</type>
        <position>Top of form</position>
        <message>Please verify your email address before signing in. Check your inbox for a verification link.</message>
        <action>
          <button>Resend Verification Email</button>
          <behavior>Triggers verification email resend (reuse from Story 01.3)</behavior>
        </action>
        <icon>Warning circle</icon>
      </email-not-verified>

      <rate-limited>
        <type>Alert banner (red)</type>
        <position>Top of form</position>
        <message>Too many sign-in attempts. Please try again in X minutes.</message>
        <countdown>Display retry-after time with live countdown</countdown>
        <icon>Block/lock icon</icon>
      </rate-limited>

      <network-error>
        <type>Alert banner (red)</type>
        <position>Top of form</position>
        <message>Unable to connect. Please check your internet connection and try again.</message>
        <icon>Wifi off icon</icon>
      </network-error>
    </error-states>

    <responsive-design>
      <desktop>Two-column layout with brand panel</desktop>
      <tablet>Two-column layout, smaller brand panel</tablet>
      <mobile>Single column, hide brand panel, full-width form</mobile>
      <breakpoint>lg (1024px)</breakpoint>
    </responsive-design>

    <dark-mode>
      <support>Full dark mode support via Tailwind dark: variants</support>
      <background>background-dark (#0a0a0b)</background>
      <surface>surface-dark (#1a1a1b)</surface>
      <text>text-primary-dark (#FAFAFA)</text>
      <borders>border-dark (#2a2a2b)</borders>
    </dark-mode>

    <accessibility>
      <form-labels>All inputs have associated label elements</form-labels>
      <aria-labels>Password visibility toggle has aria-label for screen readers</aria-labels>
      <error-announcements>Errors announced to screen readers</error-announcements>
      <focus-states>Visible focus states (ring-2 ring-primary/50)</focus-states>
      <keyboard-navigation>Full keyboard support (Tab, Enter, Escape)</keyboard-navigation>
    </accessibility>
  </ui-specifications>

  <!-- ============================================== -->
  <!-- EXISTING CODE CONTEXT -->
  <!-- ============================================== -->
  <existing-code>
    <file path="apps/web/src/lib/auth.ts">
      <purpose>better-auth server configuration</purpose>
      <key-features>
        <feature>Prisma adapter configured</feature>
        <feature>Session expiry: 7 days default</feature>
        <feature>Cookie cache: 15 minutes</feature>
        <feature>Organization plugin enabled</feature>
        <feature>Email/password auth enabled with verification hooks</feature>
      </key-features>
      <notes>
        - requireEmailVerification currently set to false for testing
        - Can be enabled by setting to true
        - sendVerificationEmail hook already configured
        - Session configuration already optimal for MVP
      </notes>
    </file>

    <file path="apps/web/src/lib/auth-client.ts">
      <purpose>better-auth React client for components</purpose>
      <available-methods>
        <method name="signIn">
          <usage>authClient.signIn.email({ email, password })</usage>
          <returns>Promise with user/session or error</returns>
        </method>
        <method name="signUp">
          <usage>authClient.signUp.email({ email, password, name })</usage>
          <returns>Promise with user/session or error</returns>
        </method>
        <method name="signOut">
          <usage>authClient.signOut()</usage>
          <returns>Promise</returns>
        </method>
        <method name="useSession">
          <usage>const { data: session } = useSession()</usage>
          <returns>React hook with session data</returns>
        </method>
      </available-methods>
      <notes>
        - Already configured with correct baseURL
        - Type-safe methods from better-auth/react
        - Needs enhancement to support rememberMe parameter
      </notes>
    </file>

    <file path="apps/web/src/lib/utils/rate-limit.ts">
      <purpose>In-memory rate limiter (MVP)</purpose>
      <key-functions>
        <function name="checkRateLimit">
          <signature>checkRateLimit(key: string, limit: number, windowSeconds: number)</signature>
          <returns>{ isRateLimited, remaining, resetAt, retryAfter }</returns>
          <usage>For sign-in: checkRateLimit(`signin:${ip}`, 5, 900)</usage>
        </function>
        <function name="getRateLimitInfo">
          <signature>getRateLimitInfo(key: string)</signature>
          <returns>{ count, resetAt }</returns>
          <usage>Check status without incrementing counter</usage>
        </function>
        <function name="resetRateLimit">
          <signature>resetRateLimit(key: string)</signature>
          <usage>Manual reset (testing, admin)</usage>
        </function>
      </key-functions>
      <notes>
        - In-memory store (cleared on restart)
        - Auto-cleanup every 5 minutes
        - Production upgrade path to Redis documented
        - Already battle-tested from Story 01.3 (verification resend)
      </notes>
    </file>

    <file path="apps/web/src/components/auth/sign-up-form.tsx">
      <purpose>Reference pattern for auth forms</purpose>
      <patterns-to-reuse>
        <pattern>react-hook-form with Zod resolver</pattern>
        <pattern>Password visibility toggle (Eye/EyeOff icons)</pattern>
        <pattern>Loading states with spinner and disabled inputs</pattern>
        <pattern>Error display (inline + form-level banner)</pattern>
        <pattern>Success state with redirect option</pattern>
        <pattern>Form structure and styling consistency</pattern>
      </patterns-to-reuse>
      <adaptations-needed>
        <adaptation>Remove confirmPassword field</adaptation>
        <adaptation>Remove name field</adaptation>
        <adaptation>Add "Remember me" checkbox</adaptation>
        <adaptation>Add "Forgot password" link</adaptation>
        <adaptation>Change submit button text to "Sign In"</adaptation>
        <adaptation>Add social sign-in buttons (non-functional)</adaptation>
        <adaptation>Change success redirect to /dashboard</adaptation>
      </adaptations-needed>
    </file>

    <file path="packages/db/prisma/schema.prisma">
      <relevant-models>
        <model name="User">
          <fields>
            <field name="id">UUID primary key</field>
            <field name="email">Unique, required</field>
            <field name="emailVerified">Boolean, default false</field>
            <field name="passwordHash">String, nullable (for OAuth users)</field>
            <field name="name">String, nullable</field>
            <field name="image">String, nullable</field>
          </fields>
          <usage>Credential validation, emailVerified check</usage>
        </model>

        <model name="Session">
          <fields>
            <field name="id">UUID primary key</field>
            <field name="userId">Foreign key to User</field>
            <field name="token">Unique session token</field>
            <field name="expiresAt">DateTime (7 or 30 days)</field>
            <field name="ipAddress">Request IP (security tracking)</field>
            <field name="userAgent">Browser info</field>
            <field name="activeWorkspaceId">Nullable (Epic 02)</field>
          </fields>
          <usage>Session creation on successful sign-in</usage>
        </model>
      </relevant-models>
    </file>
  </existing-code>

  <!-- ============================================== -->
  <!-- IMPLEMENTATION PLAN -->
  <!-- ============================================== -->
  <implementation-plan>
    <file-structure>
      <new-files>
        <file path="apps/web/src/app/(auth)/sign-in/page.tsx">
          <description>Sign-in page container component</description>
          <responsibilities>
            <item>Render AuthLayout with sign-in form</item>
            <item>Handle client-side routing</item>
            <item>Check if user already authenticated (middleware handles redirect)</item>
          </responsibilities>
        </file>

        <file path="apps/web/src/components/auth/sign-in-form.tsx">
          <description>Main sign-in form component with logic</description>
          <responsibilities>
            <item>Form state management with react-hook-form</item>
            <item>Client-side validation with Zod</item>
            <item>Call signIn API via auth-client</item>
            <item>Handle success (redirect) and errors (display)</item>
            <item>Loading states for button and inputs</item>
            <item>Remember me checkbox state</item>
          </responsibilities>
        </file>

        <file path="apps/web/src/components/auth/password-input.tsx">
          <description>Reusable password input with visibility toggle</description>
          <responsibilities>
            <item>Input field with type="password" or type="text"</item>
            <item>Eye/EyeOff icon button for toggle</item>
            <item>Accessible aria-labels</item>
            <item>Consistent styling with other auth inputs</item>
          </responsibilities>
        </file>

        <file path="apps/web/src/components/auth/social-sign-in-buttons.tsx">
          <description>Google and Microsoft OAuth buttons (non-functional)</description>
          <responsibilities>
            <item>Google button with logo</item>
            <item>Microsoft button with logo (disabled)</item>
            <item>Show "Coming soon" message or tooltip</item>
            <item>Match wireframe styling</item>
          </responsibilities>
        </file>

        <file path="apps/web/src/components/auth/auth-error-banner.tsx">
          <description>Error alert component for auth forms</description>
          <responsibilities>
            <item>Display error message with icon</item>
            <item>Support different error types (error, warning)</item>
            <item>Optional action button (e.g., resend email)</item>
            <item>Dismissible option</item>
          </responsibilities>
        </file>

        <file path="apps/web/src/lib/validations/signin.ts">
          <description>Zod schema for sign-in form validation</description>
          <schema>
            <field name="email">z.string().email()</field>
            <field name="password">z.string().min(1, "Password required")</field>
            <field name="rememberMe">z.boolean().optional()</field>
          </schema>
        </file>

        <file path="apps/web/src/hooks/use-sign-in.ts">
          <description>Optional: Custom hook for sign-in logic</description>
          <responsibilities>
            <item>Encapsulate sign-in flow</item>
            <item>Handle error states</item>
            <item>Loading states</item>
            <item>Rate limiting UI feedback</item>
          </responsibilities>
          <note>Consider if needed or if form component is sufficient</note>
        </file>
      </new-files>

      <modified-files>
        <file path="apps/web/src/lib/auth-client.ts">
          <changes>
            <change>Add rememberMe parameter support to signIn method</change>
            <change>Export typed signIn function that accepts rememberMe</change>
          </changes>
        </file>

        <file path="apps/web/src/middleware.ts">
          <changes>
            <change>Add redirect logic for authenticated users accessing /sign-in</change>
            <change>If session exists and path is /sign-in, redirect to /dashboard</change>
            <change>Prevent confusion of already-signed-in users</change>
          </changes>
        </file>

        <file path="apps/web/src/components/auth/auth-layout.tsx">
          <changes>
            <change>Verify two-column layout works for sign-in page</change>
            <change>Ensure mobile responsiveness (hide left panel)</change>
            <change>Reuse for consistent auth page structure</change>
          </changes>
          <note>Likely no changes needed, just reuse existing component</note>
        </file>

        <file path="apps/web/src/components/ui/checkbox.tsx">
          <changes>
            <change>Verify checkbox component exists and styled correctly</change>
            <change>Create if missing (use shadcn/ui checkbox)</change>
            <change>Ensure dark mode support</change>
          </changes>
        </file>
      </modified-files>

      <test-files>
        <file path="apps/web/src/components/auth/sign-in-form.test.tsx">
          <description>Unit tests for form validation and logic</description>
          <test-cases>
            <case>Email validation (valid, invalid formats)</case>
            <case>Password validation (empty, non-empty)</case>
            <case>Form submit disabled when invalid</case>
            <case>Loading state during submission</case>
            <case>Error display on failed submission</case>
            <case>Remember me checkbox state</case>
          </test-cases>
        </file>

        <file path="apps/web/tests/e2e/sign-in.spec.ts">
          <description>E2E tests for complete sign-in flows</description>
          <test-scenarios>
            <scenario name="successful-signin">
              <steps>
                <step>Navigate to /sign-in</step>
                <step>Enter valid credentials</step>
                <step>Check remember me</step>
                <step>Click sign in</step>
                <step>Verify redirect to /dashboard</step>
                <step>Verify session cookie set</step>
              </steps>
            </scenario>

            <scenario name="invalid-credentials">
              <steps>
                <step>Navigate to /sign-in</step>
                <step>Enter invalid credentials</step>
                <step>Click sign in</step>
                <step>Verify error message</step>
                <step>Verify email field not cleared</step>
              </steps>
            </scenario>

            <scenario name="unverified-email">
              <steps>
                <step>Navigate to /sign-in</step>
                <step>Enter unverified user credentials</step>
                <step>Click sign in</step>
                <step>Verify warning message</step>
                <step>Verify resend button available</step>
              </steps>
            </scenario>

            <scenario name="rate-limiting">
              <steps>
                <step>Attempt sign-in 5 times with wrong password</step>
                <step>On 6th attempt, verify rate limit error</step>
                <step>Verify countdown timer displayed</step>
                <step>Verify button disabled</step>
              </steps>
            </scenario>

            <scenario name="password-visibility-toggle">
              <steps>
                <step>Enter password (verify dots)</step>
                <step>Click eye icon</step>
                <step>Verify password visible</step>
                <step>Click icon again</step>
                <step>Verify password hidden</step>
              </steps>
            </scenario>

            <scenario name="already-authenticated-redirect">
              <steps>
                <step>Sign in successfully</step>
                <step>Navigate to /sign-in directly</step>
                <step>Verify redirect to /dashboard</step>
              </steps>
            </scenario>
          </test-scenarios>
        </file>
      </test-files>
    </file-structure>

    <implementation-steps>
      <phase name="1. Setup and Configuration" order="1">
        <step>Update auth-client.ts to support rememberMe parameter</step>
        <step>Create Zod validation schema for sign-in form</step>
        <step>Verify checkbox component exists (create if needed)</step>
      </phase>

      <phase name="2. Core Components" order="2">
        <step>Create password-input component with visibility toggle</step>
        <step>Create auth-error-banner component for error display</step>
        <step>Create social-sign-in-buttons component (non-functional)</step>
      </phase>

      <phase name="3. Main Form Component" order="3">
        <step>Create sign-in-form.tsx with react-hook-form</step>
        <step>Implement email and password inputs with validation</step>
        <step>Add remember me checkbox</step>
        <step>Add forgot password link (placeholder link OK)</step>
        <step>Implement form submission logic with signIn API</step>
        <step>Handle success: redirect to /dashboard</step>
        <step>Handle errors: display appropriate messages</step>
        <step>Implement loading states (button, inputs)</step>
      </phase>

      <phase name="4. Page and Layout" order="4">
        <step>Create sign-in page at app/(auth)/sign-in/page.tsx</step>
        <step>Use AuthLayout for consistent two-column structure</step>
        <step>Verify responsive design (mobile single column)</step>
        <step>Test dark mode support</step>
      </phase>

      <phase name="5. Middleware and Security" order="5">
        <step>Update middleware.ts for authenticated user redirect</step>
        <step>Verify rate limiting works (reuse checkRateLimit)</step>
        <step>Test emailVerified check blocks unverified users</step>
      </phase>

      <phase name="6. Testing" order="6">
        <step>Write unit tests for form validation</step>
        <step>Write unit tests for password visibility toggle</step>
        <step>Write E2E test for successful sign-in</step>
        <step>Write E2E test for invalid credentials</step>
        <step>Write E2E test for unverified user</step>
        <step>Write E2E test for rate limiting</step>
        <step>Write E2E test for authenticated redirect</step>
      </phase>

      <phase name="7. Polish and Documentation" order="7">
        <step>Verify all accessibility requirements met</step>
        <step>Verify UI matches wireframe</step>
        <step>Test on multiple browsers</step>
        <step>Update documentation if needed</step>
      </phase>
    </implementation-steps>
  </implementation-plan>

  <!-- ============================================== -->
  <!-- CODE PATTERNS AND EXAMPLES -->
  <!-- ============================================== -->
  <code-examples>
    <example name="Sign-In API Call">
      <description>How to call signIn method with rememberMe</description>
      <code language="typescript"><![CDATA[
import { authClient } from '@/lib/auth-client'

const handleSignIn = async (data: SignInFormData) => {
  try {
    const result = await authClient.signIn.email({
      email: data.email,
      password: data.password,
      rememberMe: data.rememberMe,
    })

    if (result.error) {
      // Handle error
      if (result.error.message?.includes('not verified')) {
        setError('EMAIL_NOT_VERIFIED')
      } else if (result.error.message?.includes('rate limit')) {
        setError('RATE_LIMITED')
      } else {
        setError('INVALID_CREDENTIALS')
      }
      return
    }

    // Success - redirect to dashboard
    router.push('/dashboard')
  } catch (error) {
    console.error('Sign-in error:', error)
    setError('NETWORK_ERROR')
  }
}
      ]]></code>
    </example>

    <example name="Rate Limit Check">
      <description>How to check and enforce sign-in rate limit</description>
      <code language="typescript"><![CDATA[
import { checkRateLimit } from '@/lib/utils/rate-limit'
import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  const ip = request.headers.get('x-forwarded-for') || 'unknown'

  // Check rate limit: 5 attempts per 15 minutes
  const rateLimit = checkRateLimit(`signin:${ip}`, 5, 900)

  if (rateLimit.isRateLimited) {
    return NextResponse.json(
      {
        error: 'RATE_LIMITED',
        message: `Too many sign-in attempts. Please try again in ${rateLimit.retryAfter} seconds.`,
        retryAfter: rateLimit.retryAfter,
      },
      { status: 429 }
    )
  }

  // Continue with sign-in logic...
}
      ]]></code>
    </example>

    <example name="Password Visibility Toggle">
      <description>Password input with show/hide toggle</description>
      <code language="typescript"><![CDATA[
import { useState } from 'react'
import { Eye, EyeOff } from 'lucide-react'
import { Input } from '@/components/ui/input'

export function PasswordInput({ value, onChange, ...props }) {
  const [showPassword, setShowPassword] = useState(false)

  return (
    <div className="relative">
      <Input
        type={showPassword ? 'text' : 'password'}
        value={value}
        onChange={onChange}
        className="pr-10"
        {...props}
      />
      <button
        type="button"
        onClick={() => setShowPassword(!showPassword)}
        className="absolute right-3 top-1/2 -translate-y-1/2"
        aria-label={showPassword ? 'Hide password' : 'Show password'}
      >
        {showPassword ? (
          <EyeOff className="w-4 h-4 text-gray-500" />
        ) : (
          <Eye className="w-4 h-4 text-gray-500" />
        )}
      </button>
    </div>
  )
}
      ]]></code>
    </example>

    <example name="Middleware Redirect">
      <description>Redirect authenticated users away from sign-in</description>
      <code language="typescript"><![CDATA[
import { NextRequest, NextResponse } from 'next/server'
import { auth } from '@/lib/auth'

export async function middleware(request: NextRequest) {
  const session = await auth.api.getSession({
    headers: request.headers,
  })

  // If authenticated and trying to access sign-in, redirect to dashboard
  if (session && request.nextUrl.pathname === '/sign-in') {
    return NextResponse.redirect(new URL('/dashboard', request.url))
  }

  return NextResponse.next()
}

export const config = {
  matcher: ['/sign-in', '/sign-up', '/verify-email'],
}
      ]]></code>
    </example>

    <example name="Error Banner Component">
      <description>Reusable error banner for auth forms</description>
      <code language="typescript"><![CDATA[
import { AlertCircle, AlertTriangle } from 'lucide-react'

interface AuthErrorBannerProps {
  type: 'error' | 'warning'
  message: string
  action?: {
    label: string
    onClick: () => void
  }
}

export function AuthErrorBanner({ type, message, action }: AuthErrorBannerProps) {
  const bgColor = type === 'error' ? 'bg-red-50' : 'bg-yellow-50'
  const borderColor = type === 'error' ? 'border-red-200' : 'border-yellow-200'
  const textColor = type === 'error' ? 'text-red-600' : 'text-yellow-600'
  const Icon = type === 'error' ? AlertCircle : AlertTriangle

  return (
    <div className={`p-4 ${bgColor} border ${borderColor} rounded-lg`}>
      <div className="flex items-start gap-3">
        <Icon className={`w-5 h-5 ${textColor} flex-shrink-0 mt-0.5`} />
        <div className="flex-1">
          <p className={`text-sm ${textColor}`}>{message}</p>
          {action && (
            <button
              type="button"
              onClick={action.onClick}
              className={`mt-2 text-sm font-medium ${textColor} hover:underline`}
            >
              {action.label}
            </button>
          )}
        </div>
      </div>
    </div>
  )
}
      ]]></code>
    </example>
  </code-examples>

  <!-- ============================================== -->
  <!-- TESTING STRATEGY -->
  <!-- ============================================== -->
  <testing-strategy>
    <unit-tests>
      <test-file>apps/web/src/components/auth/sign-in-form.test.tsx</test-file>
      <coverage-target>80%</coverage-target>
      <test-cases>
        <case>Email validation - valid format</case>
        <case>Email validation - invalid format (missing @)</case>
        <case>Password validation - not empty</case>
        <case>Form submission disabled when invalid</case>
        <case>Form submission enabled when valid</case>
        <case>Loading state sets button to disabled with spinner</case>
        <case>Error message displayed on failed submission</case>
        <case>Remember me checkbox state toggled</case>
        <case>Password visibility toggle works</case>
      </test-cases>
    </unit-tests>

    <integration-tests>
      <description>Test API endpoints and database operations</description>
      <test-cases>
        <case>Successful sign-in creates session in database</case>
        <case>Invalid email returns INVALID_CREDENTIALS error</case>
        <case>Invalid password returns INVALID_CREDENTIALS error</case>
        <case>Unverified email returns EMAIL_NOT_VERIFIED error</case>
        <case>HTTP-only cookie set on successful sign-in</case>
        <case>Rate limiting enforced after 5 failed attempts</case>
        <case>Remember me extends session to 30 days</case>
        <case>Session token is cryptographically secure (32 bytes)</case>
      </test-cases>
    </integration-tests>

    <e2e-tests>
      <test-file>apps/web/tests/e2e/sign-in.spec.ts</test-file>
      <scenarios>
        <scenario name="Successful Sign-In">
          <description>Complete happy path sign-in flow</description>
          <steps>
            <step>Navigate to /sign-in</step>
            <step>Verify form elements present</step>
            <step>Enter valid email and password</step>
            <step>Check remember me checkbox</step>
            <step>Click sign in button</step>
            <step>Verify loading state displayed</step>
            <step>Verify redirect to /dashboard</step>
            <step>Verify session cookie set in browser</step>
          </steps>
        </scenario>

        <scenario name="Invalid Credentials">
          <description>Error handling for wrong password</description>
          <steps>
            <step>Navigate to /sign-in</step>
            <step>Enter valid email with wrong password</step>
            <step>Click sign in button</step>
            <step>Verify error banner: "Invalid email or password"</step>
            <step>Verify email field not cleared (UX)</step>
            <step>Verify can retry immediately</step>
          </steps>
        </scenario>

        <scenario name="Unverified Email">
          <description>Block sign-in for unverified users</description>
          <steps>
            <step>Create unverified test user</step>
            <step>Navigate to /sign-in</step>
            <step>Enter unverified user credentials</step>
            <step>Click sign in button</step>
            <step>Verify warning banner with verification message</step>
            <step>Verify "Resend Verification Email" button visible</step>
            <step>Click resend button</step>
            <step>Verify success message</step>
          </steps>
        </scenario>

        <scenario name="Rate Limiting">
          <description>Enforce rate limit after 5 attempts</description>
          <steps>
            <step>Navigate to /sign-in</step>
            <step>Attempt sign-in with wrong password (repeat 5 times)</step>
            <step>On 6th attempt, verify rate limit error shown</step>
            <step>Verify error includes countdown timer</step>
            <step>Verify sign in button disabled</step>
            <step>Wait for rate limit to expire (or mock time)</step>
            <step>Verify button re-enabled</step>
          </steps>
        </scenario>

        <scenario name="Password Visibility Toggle">
          <description>Toggle between showing and hiding password</description>
          <steps>
            <step>Navigate to /sign-in</step>
            <step>Enter password</step>
            <step>Verify input type is "password" (dots visible)</step>
            <step>Click eye icon</step>
            <step>Verify input type is "text" (password visible)</step>
            <step>Click eye icon again</step>
            <step>Verify input type is "password" (hidden again)</step>
          </steps>
        </scenario>

        <scenario name="Already Authenticated Redirect">
          <description>Redirect authenticated users away from sign-in</description>
          <steps>
            <step>Sign in successfully</step>
            <step>Verify at /dashboard</step>
            <step>Navigate directly to /sign-in</step>
            <step>Verify automatically redirected back to /dashboard</step>
            <step>Verify cannot access sign-in page while authenticated</step>
          </steps>
        </scenario>

        <scenario name="Remember Me Functionality">
          <description>Verify session persistence with remember me</description>
          <steps>
            <step>Sign in with "Remember me" checked</step>
            <step>Close browser and reopen</step>
            <step>Navigate to /dashboard</step>
            <step>Verify user still signed in</step>
            <step>Verify session expiry is 30 days (check cookie)</step>
          </steps>
        </scenario>
      </scenarios>

      <edge-cases>
        <case>Empty email and password (submit disabled)</case>
        <case>Email without @ symbol (validation error)</case>
        <case>Form submission with Enter key</case>
        <case>Network error during sign-in</case>
        <case>Browser back button after sign-in</case>
        <case>Multiple tabs with sign-in form</case>
        <case>Copy-paste password with trailing spaces (should be trimmed)</case>
      </edge-cases>
    </e2e-tests>
  </testing-strategy>

  <!-- ============================================== -->
  <!-- DEFINITION OF DONE -->
  <!-- ============================================== -->
  <definition-of-done>
    <checklist>
      <item status="required">All acceptance criteria met</item>
      <item status="required">Sign-in page created at /sign-in</item>
      <item status="required">Email/password authentication working via better-auth</item>
      <item status="required">Session created in database on successful sign-in</item>
      <item status="required">HTTP-only cookie set with session token</item>
      <item status="required">Redirect to dashboard on successful sign-in</item>
      <item status="required">Invalid credentials show appropriate error message</item>
      <item status="required">Unverified email blocked with clear message and resend option</item>
      <item status="required">Rate limiting enforced (5 attempts per 15 minutes)</item>
      <item status="required">"Remember me" checkbox extends session to 30 days</item>
      <item status="required">Password show/hide toggle working</item>
      <item status="required">"Forgot password" link navigates to password reset (placeholder OK)</item>
      <item status="required">Google OAuth button displayed (non-functional, Story 01.5)</item>
      <item status="required">Loading state displayed during sign-in</item>
      <item status="required">All form validation working (client-side)</item>
      <item status="required">Responsive design matches wireframe</item>
      <item status="required">Dark mode support working</item>
      <item status="required">Middleware redirects authenticated users away from sign-in page</item>
      <item status="required">Unit tests written for form validation (80% coverage)</item>
      <item status="required">Integration tests for sign-in endpoint</item>
      <item status="required">E2E test for complete sign-in flow (all scenarios)</item>
      <item status="required">Code reviewed and approved</item>
      <item status="required">All tests passing</item>
      <item status="required">Documentation updated (if needed)</item>
    </checklist>
  </definition-of-done>

  <!-- ============================================== -->
  <!-- NOTES AND CONSIDERATIONS -->
  <!-- ============================================== -->
  <notes>
    <out-of-scope>
      <item>Google OAuth functionality - Story 01.5 will implement</item>
      <item>Microsoft OAuth - Button shown but out of scope for MVP</item>
      <item>Password reset page - Story 01.6 will implement</item>
      <item>Session management UI - Story 01.7 will implement</item>
      <item>Multi-factor authentication (2FA) - Growth feature</item>
      <item>Account linking - Part of Story 01.5</item>
      <item>Workspace selection - Epic 02</item>
    </out-of-scope>

    <design-decisions>
      <decision>
        <topic>Error Message Strategy</topic>
        <rationale>Use generic "Invalid credentials" for both wrong email and wrong password to prevent user enumeration attacks</rationale>
        <exception>Only show "Email not verified" after successful credential validation</exception>
      </decision>

      <decision>
        <topic>Rate Limiting Strategy</topic>
        <rationale>IP-based (5 per 15 min) prevents brute force, separate from verification resend limit</rationale>
        <implementation>In-memory acceptable for MVP, Redis upgrade path documented</implementation>
      </decision>

      <decision>
        <topic>Session Duration</topic>
        <rationale>7 days default (standard), 30 days with "Remember me" (convenience)</rationale>
        <access-token>15 minutes (short-lived, auto-refreshed)</access-token>
      </decision>

      <decision>
        <topic>Password Visibility Toggle</topic>
        <rationale>Improves UX especially on mobile devices where typing passwords is difficult</rationale>
        <accessibility>Button has aria-label for screen readers</accessibility>
      </decision>
    </design-decisions>

    <technical-considerations>
      <consideration>
        <topic>better-auth Session Management</topic>
        <detail>better-auth automatically creates session, sets cookie, manages tokens</detail>
        <note>Token rotation not implemented in MVP (future enhancement)</note>
      </consideration>

      <consideration>
        <topic>Remember Me Implementation</topic>
        <detail>Client sends rememberMe boolean, server extends session expiry to 30 days</detail>
        <note>No separate "remember me" token, uses same session mechanism</note>
      </consideration>

      <consideration>
        <topic>Middleware Complexity</topic>
        <detail>Simple check: if signed in and accessing /sign-in, redirect to dashboard</detail>
        <note>More complex redirect logic (query params, role-based) deferred to future stories</note>
      </consideration>
    </technical-considerations>

    <integration-notes>
      <integration source="Story 01.1">
        <detail>better-auth already configured with Prisma adapter</detail>
        <detail>API route handler at /api/auth/[...all]/route.ts handles sign-in automatically</detail>
        <detail>Session configuration already defined and optimal</detail>
      </integration>

      <integration source="Story 01.2">
        <detail>User table with passwordHash field exists</detail>
        <detail>Email/password users can be created</detail>
        <detail>Password hashing (Argon2id) already set up</detail>
      </integration>

      <integration source="Story 01.3">
        <detail>Email verification check required before allowing sign-in</detail>
        <detail>User.emailVerified field available for checking</detail>
        <detail>Resend verification email functionality can be reused</detail>
        <detail>Rate limiting utility already tested and working</detail>
      </integration>
    </integration-notes>

    <performance-targets>
      <target metric="Sign-in response time (p95)">&lt; 300ms</target>
      <target metric="Session validation (p95)">&lt; 50ms</target>
      <target metric="Password hashing">200-500ms (deliberate slow for security)</target>
      <target metric="Rate limit check">&lt; 10ms (in-memory)</target>
    </performance-targets>

    <security-notes>
      <note>All passwords hashed with Argon2id (better-auth default)</note>
      <note>Timing-safe password comparison prevents timing attacks</note>
      <note>HTTP-only cookies prevent XSS attacks on session tokens</note>
      <note>SameSite=Lax provides CSRF protection</note>
      <note>Rate limiting prevents brute force attacks</note>
      <note>Generic error messages prevent user enumeration</note>
      <note>Passwords never logged or exposed in error messages</note>
    </security-notes>
  </notes>

  <!-- ============================================== -->
  <!-- TRACEABILITY -->
  <!-- ============================================== -->
  <traceability>
    <requirements-mapping>
      <mapping>
        <ac-id>AC-1</ac-id>
        <spec-ref>UI Components Required - Sign-In Page</spec-ref>
        <component>app/(auth)/sign-in/page.tsx</component>
        <test>E2E-SIGNIN-01</test>
      </mapping>

      <mapping>
        <ac-id>AC-2</ac-id>
        <spec-ref>Database Operations - Credential Validation</spec-ref>
        <api>POST /api/auth/sign-in/email</api>
        <test>INT-AUTH-01</test>
      </mapping>

      <mapping>
        <ac-id>AC-3</ac-id>
        <spec-ref>Session Configuration</spec-ref>
        <api>POST /api/auth/sign-in/email</api>
        <test>INT-AUTH-02</test>
      </mapping>

      <mapping>
        <ac-id>AC-4</ac-id>
        <spec-ref>Session Security</spec-ref>
        <api>POST /api/auth/sign-in/email</api>
        <test>INT-AUTH-03</test>
      </mapping>

      <mapping>
        <ac-id>AC-5</ac-id>
        <spec-ref>Redirect Logic</spec-ref>
        <component>sign-in-form.tsx</component>
        <test>E2E-SIGNIN-01</test>
      </mapping>

      <mapping>
        <ac-id>AC-6</ac-id>
        <spec-ref>Error States - Invalid Credentials</spec-ref>
        <component>auth-error-banner.tsx</component>
        <test>E2E-SIGNIN-02</test>
      </mapping>

      <mapping>
        <ac-id>AC-7</ac-id>
        <spec-ref>Security - Rate Limiting</spec-ref>
        <utility>lib/utils/rate-limit.ts</utility>
        <test>INT-RATE-01, E2E-SIGNIN-04</test>
      </mapping>

      <mapping>
        <ac-id>AC-8</ac-id>
        <spec-ref>Form Validation - Email</spec-ref>
        <component>sign-in-form.tsx</component>
        <test>UNIT-FORM-01</test>
      </mapping>

      <mapping>
        <ac-id>AC-9</ac-id>
        <spec-ref>UI Components - Password Input</spec-ref>
        <component>password-input.tsx</component>
        <test>E2E-SIGNIN-06</test>
      </mapping>

      <mapping>
        <ac-id>AC-10</ac-id>
        <spec-ref>Session Configuration - Remember Me</spec-ref>
        <api>POST /api/auth/sign-in/email</api>
        <test>E2E-SIGNIN-05</test>
      </mapping>

      <mapping>
        <ac-id>AC-11</ac-id>
        <spec-ref>UI Components - Forgot Password Link</spec-ref>
        <component>sign-in-form.tsx</component>
        <test>Visual inspection</test>
      </mapping>

      <mapping>
        <ac-id>AC-12</ac-id>
        <spec-ref>Loading States</spec-ref>
        <component>sign-in-form.tsx</component>
        <test>E2E-SIGNIN-01</test>
      </mapping>

      <mapping>
        <ac-id>AC-13</ac-id>
        <spec-ref>Database Operations - Email Verification Check</spec-ref>
        <api>POST /api/auth/sign-in/email</api>
        <test>E2E-SIGNIN-03</test>
      </mapping>

      <mapping>
        <ac-id>AC-14</ac-id>
        <spec-ref>UI Components - Social Sign-In</spec-ref>
        <component>social-sign-in-buttons.tsx</component>
        <test>Visual inspection</test>
      </mapping>
    </requirements-mapping>

    <adr-mapping>
      <adr id="ADR-005">
        <title>better-auth selected for authentication</title>
        <implementation>Use emailAndPassword plugin for sign-in</implementation>
      </adr>

      <adr id="NFR-S1">
        <title>Argon2id password hashing</title>
        <implementation>better-auth default, no additional config needed</implementation>
      </adr>

      <adr id="NFR-S3">
        <title>JWT tokens for session management</title>
        <implementation>15-minute access tokens, 7-30 day database sessions</implementation>
      </adr>

      <adr id="NFR-S4">
        <title>CSRF protection</title>
        <implementation>SameSite=Lax cookies (better-auth built-in)</implementation>
      </adr>

      <adr id="NFR-S5">
        <title>XSS prevention</title>
        <implementation>HTTP-only cookies, no token in localStorage</implementation>
      </adr>

      <adr id="NFR-S7">
        <title>Rate limiting for brute force prevention</title>
        <implementation>5 attempts per 15 minutes per IP</implementation>
      </adr>
    </adr-mapping>

    <epic-spec-mapping>
      <section name="Data Models">
        <implementation>User and Session models for credential validation and session creation</implementation>
      </section>

      <section name="APIs">
        <implementation>POST /api/auth/sign-in/email endpoint integration</implementation>
      </section>

      <section name="Workflows">
        <implementation>Complete sign-in flow from form submission to dashboard redirect</implementation>
      </section>

      <section name="Security - Rate Limiting">
        <implementation>5 attempts per 15 minutes enforcement</implementation>
      </section>

      <section name="Security - Session Security">
        <implementation>HTTP-only cookies with secure flags and cryptographically secure tokens</implementation>
      </section>

      <section name="Observability">
        <event>auth.signin.success - emitted on successful sign-in</event>
        <event>auth.signin.failure - emitted on failed sign-in attempt</event>
      </section>
    </epic-spec-mapping>
  </traceability>
</story-context>
