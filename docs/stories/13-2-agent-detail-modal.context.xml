<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <metadata>
    <story-id>13.2</story-id>
    <story-name>Agent Detail Modal</story-name>
    <epic>EPIC-13</epic>
    <priority>P1 High</priority>
    <points>5</points>
    <generated-date>2025-12-06</generated-date>
  </metadata>

  <!-- ===================================================================== -->
  <!-- STORY OVERVIEW -->
  <!-- ===================================================================== -->
  <story-overview>
    <user-story>
      As a manager, I want to see detailed agent information in a modal,
      so that I can understand and configure agent behavior.
    </user-story>

    <description>
      Create a comprehensive agent detail modal with 5-tab interface providing
      full visibility into agent configuration, activity, and performance.
      Modal opens when clicking agent cards and provides quick access to all
      agent information without page navigation.
    </description>

    <acceptance-criteria>
      <criterion id="AC1">Create AgentDetailModal with 5-tab interface</criterion>
      <criterion id="AC2">Overview tab: agent info, 30-day metrics, capabilities list</criterion>
      <criterion id="AC3">Activity tab: recent actions timeline with timestamps</criterion>
      <criterion id="AC4">Configuration tab: model settings, behavior controls</criterion>
      <criterion id="AC5">Permissions tab: data access toggles, module restrictions</criterion>
      <criterion id="AC6">Analytics tab: performance charts (tasks, success rate, response time)</criterion>
      <criterion id="AC7">Edit button to modify settings from modal</criterion>
      <criterion id="AC8">Responsive design for mobile/tablet</criterion>
    </acceptance-criteria>
  </story-overview>

  <!-- ===================================================================== -->
  <!-- EXISTING PATTERNS -->
  <!-- ===================================================================== -->
  <existing-patterns>
    <!-- Dialog Component Pattern -->
    <pattern type="modal">
      <name>shadcn/ui Dialog Component</name>
      <location>apps/web/src/components/ui/dialog.tsx</location>
      <description>
        The codebase uses shadcn/ui Dialog component built on Radix UI.
        AgentDetailModal should follow this pattern for consistent modal behavior.
      </description>
      <usage>
        <![CDATA[
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from '@/components/ui/dialog'

export function AgentDetailModal({ agentId, open, onClose }: Props) {
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="max-w-4xl max-sm:h-screen max-sm:w-screen">
        <DialogHeader>
          <DialogTitle>Agent Details</DialogTitle>
        </DialogHeader>
        {/* Tab content */}
      </DialogContent>
    </Dialog>
  )
}
        ]]>
      </usage>
      <notes>
        - DialogContent has max-w-lg by default, use max-w-4xl for larger modal
        - For mobile full-screen: max-sm:h-screen max-sm:w-screen
        - Dialog automatically handles focus trap and ESC key
        - Close button (X) is built into DialogContent
      </notes>
    </pattern>

    <!-- Tabs Component - MISSING -->
    <pattern type="tabs">
      <name>Tabs Component (Not Yet Installed)</name>
      <location>apps/web/src/components/ui/tabs.tsx</location>
      <description>
        Tabs component is NOT currently installed. Need to add shadcn/ui Tabs
        component before implementing the modal.
      </description>
      <installation>
        <![CDATA[
# Install shadcn/ui tabs component:
npx shadcn-ui@latest add tabs

# This will create:
# - apps/web/src/components/ui/tabs.tsx
# - Uses @radix-ui/react-tabs under the hood
        ]]>
      </installation>
      <expected-usage>
        <![CDATA[
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs'

<Tabs defaultValue="overview" value={activeTab} onValueChange={setActiveTab}>
  <TabsList>
    <TabsTrigger value="overview">Overview</TabsTrigger>
    <TabsTrigger value="activity">Activity</TabsTrigger>
    <TabsTrigger value="configuration">Configuration</TabsTrigger>
    <TabsTrigger value="permissions">Permissions</TabsTrigger>
    <TabsTrigger value="analytics">Analytics</TabsTrigger>
  </TabsList>

  <TabsContent value="overview">
    <OverviewTab agent={agent} />
  </TabsContent>
  {/* Other tabs */}
</Tabs>
        ]]>
      </expected-usage>
    </pattern>

    <!-- React Query Hook Pattern -->
    <pattern type="data-fetching">
      <name>React Query Hooks Pattern</name>
      <location>apps/web/src/hooks/use-approvals.ts</location>
      <description>
        Standard pattern for data fetching hooks using React Query.
        Shows proper query key structure, error handling, and mutation patterns.
      </description>
      <example>
        <![CDATA[
// Hook to fetch single entity by ID
export function useAgent(id: string) {
  return useQuery({
    queryKey: ['agents', id],
    queryFn: () => fetchAgent(id),
    enabled: !!id, // Only fetch if ID is provided
  })
}

// Hook for mutations with cache invalidation
export function useUpdateAgent(id: string) {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: (config: Partial<Agent['config']>) =>
      updateAgent(id, config),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['approvals'] })
      queryClient.invalidateQueries({ queryKey: ['agents', id] })
    },
  })
}
        ]]>
      </example>
      <notes>
        - Use queryKey arrays: ['resource', id] for single items
        - Set enabled: !!id to prevent fetching with undefined ID
        - Invalidate both list and detail queries on mutation
        - Include staleTime for data that doesn't change often
      </notes>
    </pattern>

    <!-- API Client Pattern -->
    <pattern type="api">
      <name>API Endpoint Pattern</name>
      <location>apps/web/src/app/api/approvals/metrics/route.ts</location>
      <description>
        Standard Next.js API route pattern with session validation,
        error handling, and consistent response format.
      </description>
      <example>
        <![CDATA[
import { NextResponse } from 'next/server'
import { getSession } from '@/lib/auth-server'

export async function GET(
  request: Request,
  { params }: { params: { id: string } }
) {
  try {
    const session = await getSession()

    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    // TODO: Replace with real database query when Prisma is connected
    const mockData = { /* ... */ }

    return NextResponse.json(
      { data: mockData },
      {
        headers: { 'Cache-Control': 'no-store, max-age=0' },
      }
    )
  } catch (error) {
    console.error('Error:', error)
    return NextResponse.json(
      { error: 'Failed to fetch' },
      { status: 500 }
    )
  }
}
        ]]>
      </example>
      <notes>
        - Always validate session first
        - Return { data: ... } or { error: ... } format
        - Use no-store for user-specific data
        - Mock data is acceptable with TODO comment for Prisma integration
      </notes>
    </pattern>

    <!-- Unsaved Changes Pattern -->
    <pattern type="form-state">
      <name>Unsaved Changes Detection</name>
      <location>apps/web/src/hooks/use-unsaved-changes.ts</location>
      <description>
        Hook for tracking unsaved form changes and preventing accidental navigation.
        Use in ConfigurationTab for edit mode.
      </description>
      <example>
        <![CDATA[
import { useUnsavedChanges } from '@/hooks/use-unsaved-changes'

export function ConfigurationTab() {
  const [formData, setFormData] = useState<Partial<Agent['config']>>({})
  const [isDirty, setIsDirty] = useState(false)

  const { confirmNavigation } = useUnsavedChanges(isDirty)

  const handleClose = () => {
    if (confirmNavigation()) {
      onClose()
    }
  }
}
        ]]>
      </example>
    </pattern>
  </existing-patterns>

  <!-- ===================================================================== -->
  <!-- AGENT COMPONENTS FROM STORY 13.1 -->
  <!-- ===================================================================== -->
  <existing-components>
    <component name="AgentAvatar">
      <location>apps/web/src/components/agents/AgentAvatar.tsx</location>
      <description>
        Avatar component with status indicator. Supports emoji avatars and
        image URLs with fallback to initials. Includes pulsing status dot.
      </description>
      <interface>
        <![CDATA[
interface AgentAvatarProps {
  agent: Agent
  size?: 'sm' | 'md' | 'lg'  // sm: 32px, md: 48px, lg: 64px
  showStatus?: boolean
  className?: string
}
        ]]>
      </interface>
      <usage>
        <![CDATA[
// Use in modal header with large size and status
<AgentAvatar agent={agent} size="lg" showStatus />
        ]]>
      </usage>
    </component>

    <component name="AgentStatusBadge">
      <location>apps/web/src/components/agents/AgentStatusBadge.tsx</location>
      <description>
        Status badge component showing agent operational status.
        Color-coded: green (online), yellow (busy), gray (offline), red (error).
      </description>
    </component>

    <component name="AgentCardCompact">
      <location>apps/web/src/components/agents/AgentCardCompact.tsx</location>
      <description>
        Minimal agent card with avatar, name, and status.
        Can be used as reference for consistent agent display.
      </description>
    </component>
  </existing-components>

  <!-- ===================================================================== -->
  <!-- TYPE DEFINITIONS -->
  <!-- ===================================================================== -->
  <type-definitions>
    <type name="Agent">
      <location>packages/shared/src/types/agent.ts</location>
      <definition>
        <![CDATA[
export interface Agent {
  // Identity
  id: string;
  name: string;                    // e.g., "Vera"
  role: string;                    // e.g., "Validation Orchestrator"
  team: AgentTeam;                 // validation | planning | branding | approval | orchestrator
  description: string;
  avatar: string;                  // Emoji or image URL
  themeColor: string;              // Hex color

  // Status
  status: AgentStatus;             // online | busy | offline | error
  lastActive: Date;

  // Capabilities
  capabilities: string[];          // List of capabilities

  // Performance Metrics (30-day rolling)
  metrics: {
    tasksCompleted: number;
    successRate: number;           // 0-100
    avgResponseTime: number;       // milliseconds
    confidenceAvg: number;         // 0-100
  };

  // Configuration
  config: {
    providerId: string | null;     // AI provider override
    model: string | null;          // Model override
    temperature: number;           // 0-2
    maxTokens: number;
    contextWindow: number;         // 4000 | 8000 | 16000
    automationLevel: 'manual' | 'smart' | 'full_auto';
    confidenceThreshold: number;   // 0-100
    tone: number;                  // 0-100 (0=professional, 100=casual)
    customInstructions: string;
  };

  // Permissions
  permissions: {
    dataAccess: string[];          // Modules agent can access
    canExecuteActions: boolean;
    requiresApproval: boolean;
  };

  // Metadata
  workspaceId: string;
  enabled: boolean;
  createdAt: Date;
  updatedAt: Date;
}

export type AgentTeam = 'validation' | 'planning' | 'branding' | 'approval' | 'orchestrator';
export type AgentStatus = 'online' | 'busy' | 'offline' | 'error';
export type AgentAutomationLevel = 'manual' | 'smart' | 'full_auto';
        ]]>
      </definition>
    </type>

    <type name="AgentActivity">
      <definition>
        <![CDATA[
interface AgentActivity {
  id: string;
  agentId: string;
  agentName: string;
  type: ActivityType;              // task_started | task_completed | approval_requested | error
  action: string;                  // Human-readable description
  module: string;                  // validation | planning | branding
  status: 'pending' | 'completed' | 'failed';
  confidenceScore?: number;        // 0-100 if applicable
  startedAt: Date;
  completedAt?: Date;
  duration?: number;               // milliseconds
}

type ActivityType = 'task_started' | 'task_completed' | 'approval_requested' | 'error';
        ]]>
      </definition>
    </type>
  </type-definitions>

  <!-- ===================================================================== -->
  <!-- CHART LIBRARY -->
  <!-- ===================================================================== -->
  <chart-library>
    <library name="recharts">
      <status>ALREADY INSTALLED</status>
      <version>3.5.1</version>
      <location>apps/web/package.json</location>
      <description>
        Recharts is already installed in the project. Use for analytics charts
        in AnalyticsTab.
      </description>
      <usage-example>
        <![CDATA[
import {
  LineChart,
  Line,
  BarChart,
  Bar,
  AreaChart,
  Area,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer
} from 'recharts'

// Tasks over time (line chart)
<ResponsiveContainer width="100%" height={300}>
  <LineChart data={tasksData}>
    <CartesianGrid strokeDasharray="3 3" />
    <XAxis dataKey="date" />
    <YAxis />
    <Tooltip />
    <Line type="monotone" dataKey="tasks" stroke="#8884d8" />
  </LineChart>
</ResponsiveContainer>

// Success rate by type (bar chart)
<ResponsiveContainer width="100%" height={300}>
  <BarChart data={successData}>
    <CartesianGrid strokeDasharray="3 3" />
    <XAxis dataKey="type" />
    <YAxis />
    <Tooltip />
    <Bar dataKey="successRate" fill="#82ca9d" />
  </BarChart>
</ResponsiveContainer>

// Response time trend (area chart)
<ResponsiveContainer width="100%" height={300}>
  <AreaChart data={responseTimeData}>
    <CartesianGrid strokeDasharray="3 3" />
    <XAxis dataKey="date" />
    <YAxis />
    <Tooltip />
    <Area type="monotone" dataKey="avgResponseTime" stroke="#8884d8" fill="#8884d8" />
  </AreaChart>
</ResponsiveContainer>
        ]]>
      </usage-example>
      <notes>
        - Use ResponsiveContainer for responsive charts
        - Dark mode: Adjust stroke/fill colors for dark background
        - Data format: Array of objects with key-value pairs
        - Tooltip shows data on hover
      </notes>
    </library>
  </chart-library>

  <!-- ===================================================================== -->
  <!-- API ENDPOINTS TO CREATE -->
  <!-- ===================================================================== -->
  <api-endpoints>
    <endpoint>
      <method>GET</method>
      <path>/api/agents/:id</path>
      <description>Get single agent with full details</description>
      <response>
        <![CDATA[
{
  "data": {
    "id": "vera",
    "name": "Vera",
    "role": "Validation Orchestrator",
    "team": "validation",
    "description": "Leads the validation team...",
    "avatar": "ðŸ”",
    "themeColor": "#3b82f6",
    "status": "online",
    "lastActive": "2025-12-06T10:30:00Z",
    "capabilities": [
      "Market sizing analysis",
      "Competitor mapping",
      "Customer discovery"
    ],
    "metrics": {
      "tasksCompleted": 145,
      "successRate": 87,
      "avgResponseTime": 2400,
      "confidenceAvg": 82
    },
    "config": {
      "providerId": null,
      "model": null,
      "temperature": 1.0,
      "maxTokens": 4000,
      "contextWindow": 8000,
      "automationLevel": "smart",
      "confidenceThreshold": 70,
      "tone": 50,
      "customInstructions": ""
    },
    "permissions": {
      "dataAccess": ["crm", "content", "analytics"],
      "canExecuteActions": true,
      "requiresApproval": false
    }
  }
}
        ]]>
      </response>
      <notes>
        Use mock data initially with TODO comment for Prisma integration.
      </notes>
    </endpoint>

    <endpoint>
      <method>GET</method>
      <path>/api/agents/:id/activity</path>
      <description>Get paginated activity list for agent</description>
      <query-params>
        - page: number (default: 1)
        - limit: number (default: 50)
        - type: ActivityType (optional filter)
      </query-params>
      <response>
        <![CDATA[
{
  "data": [
    {
      "id": "act_123",
      "agentId": "vera",
      "agentName": "Vera",
      "type": "task_completed",
      "action": "Analyzed market size for SaaS idea",
      "module": "validation",
      "status": "completed",
      "confidenceScore": 85,
      "startedAt": "2025-12-06T09:15:00Z",
      "completedAt": "2025-12-06T09:18:30Z",
      "duration": 210000
    }
  ],
  "meta": {
    "total": 150,
    "page": 1,
    "limit": 50,
    "totalPages": 3
  }
}
        ]]>
      </response>
    </endpoint>

    <endpoint>
      <method>GET</method>
      <path>/api/agents/:id/analytics</path>
      <description>Get analytics data for charts (30-day time series)</description>
      <response>
        <![CDATA[
{
  "data": {
    "tasksOverTime": [
      { "date": "2025-11-07", "tasks": 12 },
      { "date": "2025-11-08", "tasks": 15 },
      // ... 30 days
    ],
    "successByType": [
      { "type": "Market Sizing", "successRate": 90 },
      { "type": "Competitor Analysis", "successRate": 85 },
      { "type": "Customer Discovery", "successRate": 88 }
    ],
    "responseTimeTrend": [
      { "date": "2025-11-07", "avgResponseTime": 2300 },
      { "date": "2025-11-08", "avgResponseTime": 2450 },
      // ... 30 days
    ]
  }
}
        ]]>
      </response>
    </endpoint>

    <endpoint>
      <method>PATCH</method>
      <path>/api/agents/:id</path>
      <description>Update agent configuration</description>
      <request-body>
        <![CDATA[
{
  "temperature": 1.2,
  "maxTokens": 5000,
  "automationLevel": "full_auto",
  "confidenceThreshold": 75
}
        ]]>
      </request-body>
      <response>
        <![CDATA[
{
  "data": {
    // Updated agent object
  }
}
        ]]>
      </response>
      <validation>
        - temperature: 0-2
        - maxTokens: 100-100000
        - contextWindow: 4000 | 8000 | 16000
        - confidenceThreshold: 0-100
        - tone: 0-100
        - customInstructions: max 500 characters
      </validation>
    </endpoint>
  </api-endpoints>

  <!-- ===================================================================== -->
  <!-- IMPLEMENTATION GUIDANCE -->
  <!-- ===================================================================== -->
  <implementation-guidance>
    <step number="1">
      <title>Install Missing Dependencies</title>
      <tasks>
        - Install shadcn/ui tabs component: npx shadcn-ui@latest add tabs
        - Verify recharts is available (already in package.json)
      </tasks>
    </step>

    <step number="2">
      <title>Create API Routes</title>
      <tasks>
        - Create GET /api/agents/[id]/route.ts
        - Create GET /api/agents/[id]/activity/route.ts
        - Create GET /api/agents/[id]/analytics/route.ts
        - Create PATCH /api/agents/[id]/route.ts
        - Use mock data with TODO comments for Prisma integration
      </tasks>
    </step>

    <step number="3">
      <title>Create React Query Hooks</title>
      <tasks>
        - Create hooks/use-agent.ts with useAgent(id) hook
        - Create hooks/use-agent-activity.ts with useAgentActivity(agentId) hook
        - Create hooks/use-agent-analytics.ts with useAgentAnalytics(agentId) hook
        - Create hooks/use-update-agent.ts with useUpdateAgent(id) mutation
        - Follow pattern from use-approvals.ts
      </tasks>
    </step>

    <step number="4">
      <title>Create Tab Components</title>
      <tasks>
        - Create tabs/OverviewTab.tsx (agent info, metrics cards, capabilities)
        - Create tabs/ActivityTab.tsx (timeline with filtering)
        - Create tabs/ConfigurationTab.tsx (form with validation, edit mode)
        - Create tabs/PermissionsTab.tsx (toggles and matrix)
        - Create tabs/AnalyticsTab.tsx (recharts for 3 charts)
        - Each tab receives agent data as prop
      </tasks>
    </step>

    <step number="5">
      <title>Create Main Modal Component</title>
      <tasks>
        - Create AgentDetailModal.tsx
        - Use Dialog from shadcn/ui
        - Use Tabs for 5-tab interface
        - Handle modal state (open/close)
        - Implement deep linking via URL params
        - Add Edit button in header (toggles edit mode in ConfigurationTab)
      </tasks>
    </step>

    <step number="6">
      <title>Implement Responsive Design</title>
      <tasks>
        - Desktop: max-w-4xl modal
        - Mobile: max-sm:h-screen max-sm:w-screen (full screen)
        - Tablet: Tabs may wrap or use dropdown
        - Test on all breakpoints
      </tasks>
    </step>

    <step number="7">
      <title>Add Form Validation (ConfigurationTab)</title>
      <tasks>
        - Create Zod schema for config validation
        - Implement edit mode state
        - Add Save/Cancel buttons when editing
        - Use useUnsavedChanges hook for navigation warning
        - Show validation errors inline
      </tasks>
    </step>

    <step number="8">
      <title>Test and Polish</title>
      <tasks>
        - Unit tests for all tab components
        - Integration tests for modal interactions
        - E2E test for opening modal and switching tabs
        - Dark mode support
        - Keyboard navigation (arrow keys, ESC)
        - Accessibility (ARIA labels, focus management)
      </tasks>
    </step>
  </implementation-guidance>

  <!-- ===================================================================== -->
  <!-- VALIDATION SCHEMA -->
  <!-- ===================================================================== -->
  <validation-schema>
    <![CDATA[
import { z } from 'zod'

export const agentConfigSchema = z.object({
  providerId: z.string().nullable().optional(),
  model: z.string().nullable().optional(),
  temperature: z.number().min(0).max(2),
  maxTokens: z.number().min(100).max(100000),
  contextWindow: z.enum(['4000', '8000', '16000']),
  automationLevel: z.enum(['manual', 'smart', 'full_auto']),
  confidenceThreshold: z.number().min(0).max(100),
  tone: z.number().min(0).max(100),
  customInstructions: z.string().max(500),
})

export type AgentConfigInput = z.infer<typeof agentConfigSchema>
    ]]>
  </validation-schema>

  <!-- ===================================================================== -->
  <!-- STYLING GUIDELINES -->
  <!-- ===================================================================== -->
  <styling-guidelines>
    <guideline>
      <title>Modal Layout</title>
      <description>
        - Desktop: max-w-4xl (larger than default max-w-lg)
        - Mobile: Full screen with max-sm:h-screen max-sm:w-screen
        - Header: Fixed with agent avatar, name, status
        - Tabs: Horizontal below header (wrap on tablet)
        - Content: Scrollable with padding
      </description>
    </guideline>

    <guideline>
      <title>Tab Interface</title>
      <description>
        - Use shadcn/ui Tabs component
        - Active tab: Accent color underline
        - Keyboard navigation: Arrow keys to switch tabs
        - Tab badges: Show count (e.g., "Activity (12)")
      </description>
    </guideline>

    <guideline>
      <title>Metric Cards (OverviewTab)</title>
      <description>
        - 2x2 grid on desktop
        - Stacked on mobile
        - Each card: Icon, Label, Value, Delta (optional)
        - Use shadcn/ui Card component
      </description>
    </guideline>

    <guideline>
      <title>Timeline (ActivityTab)</title>
      <description>
        - Vertical timeline with dots
        - Each item: Timestamp (relative), Action, Status badge
        - Color-coded status: green (completed), yellow (pending), red (failed)
        - Infinite scroll or pagination for older items
      </description>
    </guideline>

    <guideline>
      <title>Form (ConfigurationTab)</title>
      <description>
        - Read-only by default
        - Edit button in modal header enables editing
        - Save/Cancel buttons appear when editing
        - Inline validation errors
        - Unsaved changes warning on close
      </description>
    </guideline>

    <guideline>
      <title>Charts (AnalyticsTab)</title>
      <description>
        - ResponsiveContainer for all charts
        - Height: 300px per chart
        - Dark mode: Adjust colors (use CSS variables)
        - Stat cards above charts with week-over-week deltas
      </description>
    </guideline>

    <guideline>
      <title>Dark Mode</title>
      <description>
        - All components support dark mode via Tailwind dark: variants
        - Chart colors adjusted for dark background
        - Use CSS variables from theme for consistency
      </description>
    </guideline>
  </styling-guidelines>

  <!-- ===================================================================== -->
  <!-- ACCESSIBILITY -->
  <!-- ===================================================================== -->
  <accessibility>
    <requirement>Keyboard Navigation</requirement>
    <description>
      - Tab key to navigate between tabs
      - Arrow keys to switch active tab
      - ESC key to close modal
      - Enter/Space to activate buttons
    </description>

    <requirement>ARIA Labels</requirement>
    <description>
      - Modal: role="dialog", aria-labelledby="modal-title"
      - Tabs: Built-in ARIA from Radix UI
      - Form inputs: aria-describedby for errors
      - Status indicators: aria-label with status text
    </description>

    <requirement>Focus Management</requirement>
    <description>
      - Focus trapped in modal when open
      - Focus returns to trigger element on close
      - Tab order follows visual layout
    </description>

    <requirement>Screen Reader</requirement>
    <description>
      - Announce tab changes
      - Chart data available in table format (sr-only)
      - Error messages announced
    </description>
  </accessibility>

  <!-- ===================================================================== -->
  <!-- TESTING REQUIREMENTS -->
  <!-- ===================================================================== -->
  <testing-requirements>
    <unit-tests>
      <test>AgentDetailModal renders all 5 tabs</test>
      <test>Switches tabs on click</test>
      <test>OverviewTab displays agent info and metrics</test>
      <test>ActivityTab renders timeline items</test>
      <test>ConfigurationTab enables editing on Edit button click</test>
      <test>ConfigurationTab shows unsaved changes warning</test>
      <test>PermissionsTab renders toggles</test>
      <test>AnalyticsTab renders charts with data</test>
    </unit-tests>

    <integration-tests>
      <test>Modal opens from agent card click</test>
      <test>Configuration save updates agent</test>
      <test>Activity timeline loads and displays</test>
      <test>Permissions changes are validated</test>
      <test>Charts render with analytics data</test>
    </integration-tests>

    <e2e-tests>
      <test>User can view agent details modal</test>
      <test>User can switch between tabs</test>
      <test>User can edit agent configuration</test>
      <test>Modal closes on ESC key</test>
      <test>Responsive behavior on mobile</test>
    </e2e-tests>
  </testing-requirements>

  <!-- ===================================================================== -->
  <!-- RELATED FILES -->
  <!-- ===================================================================== -->
  <related-files>
    <file>
      <path>docs/stories/13-2-agent-detail-modal.md</path>
      <description>Full story specification</description>
    </file>
    <file>
      <path>docs/epics/EPIC-13-ai-agent-management.md</path>
      <description>Epic overview and all stories</description>
    </file>
    <file>
      <path>docs/sprint-artifacts/tech-spec-epic-13.md</path>
      <description>Technical specification for Epic 13</description>
    </file>
    <file>
      <path>packages/shared/src/types/agent.ts</path>
      <description>Agent type definitions</description>
    </file>
    <file>
      <path>apps/web/src/components/agents/AgentAvatar.tsx</path>
      <description>Agent avatar component from Story 13.1</description>
    </file>
    <file>
      <path>apps/web/src/components/ui/dialog.tsx</path>
      <description>shadcn/ui Dialog component</description>
    </file>
    <file>
      <path>apps/web/src/hooks/use-approvals.ts</path>
      <description>Example React Query hook pattern</description>
    </file>
    <file>
      <path>apps/web/src/hooks/use-unsaved-changes.ts</path>
      <description>Hook for unsaved changes detection</description>
    </file>
  </related-files>

  <!-- ===================================================================== -->
  <!-- NOTES -->
  <!-- ===================================================================== -->
  <notes>
    <note priority="high">
      Tabs component is NOT currently installed. Must install shadcn/ui tabs
      before implementing the modal.
    </note>
    <note priority="high">
      Use mock data for API endpoints with TODO comments for Prisma integration.
      This is acceptable pattern based on existing code.
    </note>
    <note priority="medium">
      Consider lazy loading tab content to improve initial modal open performance.
    </note>
    <note priority="medium">
      Activity tab should support infinite scroll for better UX with large datasets.
    </note>
    <note priority="medium">
      Edit button should only be visible to users with agent.configure permission
      (implement basic permission check).
    </note>
    <note priority="low">
      Modal should maintain scroll position when switching tabs for better UX.
    </note>
  </notes>
</story-context>
