<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <story>
    <id>13.1</id>
    <title>Agent Card Components</title>
    <epic>EPIC-13: AI Agent Management</epic>
    <status>ready-for-dev</status>
    <points>3</points>
    <priority>P1 High</priority>
  </story>

  <acceptance-criteria>
    <criterion id="AC1">Create AgentCardCompact component (avatar + name + status dot)</criterion>
    <criterion id="AC2">Create AgentCardStandard component (with performance stats)</criterion>
    <criterion id="AC3">Create AgentCardExpanded component (with action buttons)</criterion>
    <criterion id="AC4">Create AgentAvatar component with status indicator</criterion>
    <criterion id="AC5">Pulsing green dot animation for online status</criterion>
    <criterion id="AC6">Display performance stats (tasks completed, success rate)</criterion>
    <criterion id="AC7">"Chat with Agent" button on expanded card</criterion>
    <criterion id="AC8">Full dark mode support</criterion>
  </acceptance-criteria>

  <type-definitions>
    <agent-types>
      <source>docs/sprint-artifacts/tech-spec-epic-13.md</source>
      <typescript><![CDATA[
/**
 * Agent configuration and metadata
 * From Tech Spec - Epic 13
 */
interface Agent {
  id: string;                      // Unique agent ID
  name: string;                    // Display name (e.g., "Vera")
  role: string;                    // Agent role (e.g., "Validation Orchestrator")
  team: AgentTeam;                 // Team type: validation | planning | branding | approval | orchestrator
  description: string;             // Agent description
  avatar: string;                  // Emoji or image URL
  themeColor: string;              // Brand color (hex)

  // Status
  status: AgentStatus;             // online | busy | offline | error
  lastActive: Date;                // Last activity timestamp

  // Capabilities
  capabilities: string[];          // List of agent capabilities

  // Performance Metrics (30-day rolling)
  metrics: {
    tasksCompleted: number;
    successRate: number;           // 0-100
    avgResponseTime: number;       // milliseconds
    confidenceAvg: number;         // 0-100
  };

  // Configuration
  config: {
    providerId: string | null;     // AI provider override (null = use workspace default)
    model: string | null;          // Model override (null = use workspace default)
    temperature: number;           // 0-2 (default 1)
    maxTokens: number;             // Max tokens per request
    contextWindow: number;         // 4000 | 8000 | 16000
    automationLevel: 'manual' | 'smart' | 'full_auto';
    confidenceThreshold: number;   // 0-100
    tone: number;                  // 0-100 (0=professional, 100=casual)
    customInstructions: string;    // Additional instructions
  };

  // Permissions
  permissions: {
    dataAccess: string[];          // Modules agent can access
    canExecuteActions: boolean;    // Can execute vs. recommend only
    requiresApproval: boolean;     // All actions need approval
  };

  // Metadata
  workspaceId: string;             // Workspace tenant ID
  enabled: boolean;                // Agent enabled/disabled
  createdAt: Date;
  updatedAt: Date;
}

type AgentTeam = 'validation' | 'planning' | 'branding' | 'approval' | 'orchestrator';
type AgentStatus = 'online' | 'busy' | 'offline' | 'error';
]]></typescript>
      <note>This type should be created in packages/shared/src/types/agent.ts</note>
    </agent-types>

    <component-props>
      <typescript><![CDATA[
// AgentAvatar.tsx
interface AgentAvatarProps {
  agent: Agent;
  size?: 'sm' | 'md' | 'lg';
  showStatus?: boolean;
}

// AgentStatusBadge.tsx
interface AgentStatusBadgeProps {
  status: AgentStatus; // 'online' | 'busy' | 'offline' | 'error'
  size?: 'sm' | 'md';
}

// AgentCardCompact.tsx
interface AgentCardCompactProps {
  agent: Agent;
  onClick?: () => void;
}

// AgentCardStandard.tsx
interface AgentCardStandardProps {
  agent: Agent;
  onClick?: () => void;
}

// AgentCardExpanded.tsx
interface AgentCardExpandedProps {
  agent: Agent;
  onConfigure?: () => void;
  onChat?: () => void;
}
]]></typescript>
    </component-props>
  </type-definitions>

  <existing-patterns>
    <approval-card-pattern>
      <file>apps/web/src/components/approval/approval-card.tsx</file>
      <description>Similar card pattern with compact/expanded variants</description>
      <key-patterns>
        <pattern name="variant-switching">Uses variant prop to switch between 'compact' and 'expanded' layouts</pattern>
        <pattern name="border-coloring">Uses conditional border-left color classes based on status/level</pattern>
        <pattern name="badge-usage">Multiple Badge components for status, type, priority indicators</pattern>
        <pattern name="dark-mode">Comprehensive dark: class variants for all elements</pattern>
        <pattern name="metadata-section">Consistent footer section with icons and timestamps</pattern>
      </key-patterns>
      <code-snippet><![CDATA[
// Pattern: Border coloring based on status
const borderColor = {
  high: 'border-l-green-500',
  medium: 'border-l-yellow-500',
  low: 'border-l-red-500',
}[approval.confidenceLevel]

// Pattern: Variant switching
if (variant === 'compact') {
  return (
    <Card className={cn('border-l-4 transition-shadow hover:shadow-md', borderColor, className)}>
      <div className="p-6 space-y-4">
        {/* Content */}
      </div>
    </Card>
  )
}

// Pattern: Dark mode color classes
<Badge variant="outline" className="text-xs">
  <Tag className="mr-1 h-3 w-3" />
  {approval.type}
</Badge>
]]></code-snippet>
    </approval-card-pattern>

    <card-component>
      <file>apps/web/src/components/ui/card.tsx</file>
      <description>shadcn/ui Card component with sub-components</description>
      <exports>
        <export>Card - base container with rounded border and shadow</export>
        <export>CardHeader - header section with padding and spacing</export>
        <export>CardTitle - large semibold title</export>
        <export>CardDescription - muted description text</export>
        <export>CardContent - main content area with padding</export>
        <export>CardFooter - footer section with flex layout</export>
      </exports>
      <base-classes>rounded-lg border bg-card text-card-foreground shadow-sm</base-classes>
    </card-component>

    <avatar-component>
      <file>apps/web/src/components/ui/avatar.tsx</file>
      <description>Radix UI Avatar with Image and Fallback</description>
      <usage><![CDATA[
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar'

<Avatar>
  <AvatarImage src={imageUrl} alt={name} />
  <AvatarFallback>{initials}</AvatarFallback>
</Avatar>
]]></usage>
      <base-classes>relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full</base-classes>
    </avatar-component>

    <badge-component>
      <file>apps/web/src/components/ui/badge.tsx</file>
      <description>Badge component with variant support</description>
      <variants>
        <variant name="default">bg-primary text-primary-foreground</variant>
        <variant name="secondary">bg-secondary text-secondary-foreground</variant>
        <variant name="destructive">bg-destructive text-destructive-foreground</variant>
        <variant name="outline">text-foreground with border</variant>
        <variant name="success">bg-green-500 text-white</variant>
      </variants>
      <usage><![CDATA[
import { Badge } from '@/components/ui/badge'

<Badge variant="success">Online</Badge>
<Badge variant="outline">Planning</Badge>
]]></usage>
    </badge-component>

    <button-component>
      <file>apps/web/src/components/ui/button.tsx</file>
      <description>Button component with variants and sizes</description>
      <variants>
        <variant name="default">bg-primary text-primary-foreground</variant>
        <variant name="destructive">bg-destructive text-destructive-foreground</variant>
        <variant name="outline">border with bg-background</variant>
        <variant name="secondary">bg-secondary text-secondary-foreground</variant>
        <variant name="ghost">transparent with hover effect</variant>
        <variant name="link">underline text link</variant>
      </variants>
      <sizes>
        <size name="default">h-10 px-4 py-2</size>
        <size name="sm">h-9 px-3</size>
        <size name="lg">h-11 px-8</size>
        <size name="icon">h-10 w-10</size>
      </sizes>
    </button-component>
  </existing-patterns>

  <styling-system>
    <tailwind-config>
      <file>tailwind.config.ts</file>
      <dark-mode>class-based (darkMode: "class")</dark-mode>
      <agent-colors>
        <description>Pre-defined color scales for each agent character</description>
        <available-agents>
          <agent name="hub">Coral - agent.hub.DEFAULT, agent.hub.light, agent.hub.dark</agent>
          <agent name="maya">Teal - agent.maya.DEFAULT, agent.maya.light, agent.maya.dark</agent>
          <agent name="atlas">Blue - agent.atlas.DEFAULT, agent.atlas.light, agent.atlas.dark</agent>
          <agent name="sage">Green - agent.sage.DEFAULT, agent.sage.light, agent.sage.dark</agent>
          <agent name="nova">Purple - agent.nova.DEFAULT, agent.nova.light, agent.nova.dark</agent>
          <agent name="echo">Gray - agent.echo.DEFAULT, agent.echo.light, agent.echo.dark</agent>
        </available-agents>
        <usage-note>Use themeColor from Agent interface for dynamic styling</usage-note>
      </agent-colors>
      <semantic-colors>
        <success>Green scale (success.50 to success.700)</success>
        <warning>Yellow scale (warning.50 to warning.700)</warning>
        <error>Red scale (error.50 to error.700)</error>
        <info>Blue scale (info.50 to info.700)</info>
      </semantic-colors>
      <animations>
        <animation name="fade-in">fade-in var(--duration-normal) var(--ease-out)</animation>
        <animation name="scale-in">scale-in var(--duration-normal) var(--ease-out)</animation>
        <animation name="hover-lift">translateY(-2px) on hover</animation>
        <custom-needed>pulse-dot animation for status indicator</custom-needed>
      </animations>
    </tailwind-config>

    <layout-constants>
      <file>apps/web/src/lib/layout-constants.ts</file>
      <available-constants>
        <constant name="ANIMATION.FAST">150ms - for hover effects</constant>
        <constant name="ANIMATION.DEFAULT">200ms - for most UI changes</constant>
        <constant name="ANIMATION.SLOW">300ms - for panel animations</constant>
        <constant name="Z_INDEX.DROPDOWN">100 - for dropdowns/tooltips</constant>
        <constant name="Z_INDEX.MODAL">200 - for modals/dialogs</constant>
      </available-constants>
      <usage>import { ANIMATION } from '@/lib/layout-constants'</usage>
    </layout-constants>

    <tailwind-dynamic-classes-warning>
      <critical-rule>Tailwind JIT requires complete class strings in source</critical-rule>
      <wrong><![CDATA[
// ❌ WRONG - JIT can't detect these
const width = isWide ? 'w-64' : 'w-16';
className={`ml-${collapsed ? '16' : '64'}`}
]]></wrong>
      <correct><![CDATA[
// ✅ CORRECT - Full class strings visible
className={collapsed ? 'ml-16' : 'ml-64'}
className={status === 'online' ? 'bg-green-500' : 'bg-gray-500'}

// ✅ CORRECT - Use inline styles for truly dynamic values
style={{ marginLeft: collapsed ? 64 : 256 }}
]]></correct>
    </tailwind-dynamic-classes-warning>
  </styling-system>

  <ui-components-available>
    <shadcn-components>
      <component>alert-dialog - For confirmation dialogs</component>
      <component>alert - For notifications/messages</component>
      <component>avatar - User/agent avatar display</component>
      <component>badge - Status and category indicators</component>
      <component>button - Interactive buttons</component>
      <component>calendar - Date selection (if needed)</component>
      <component>card - Container for content sections</component>
      <component>checkbox - Selection controls</component>
      <component>countdown-button - Custom countdown button</component>
      <component>countdown-timer - Custom countdown timer</component>
      <component>dialog - Modal dialogs</component>
      <component>dropdown-menu - Dropdown menus</component>
      <component>error-boundary - Error handling wrapper</component>
      <component>input - Text input fields</component>
      <component>label - Form labels</component>
      <component>popover - Floating content</component>
      <component>progress - Progress indicators</component>
      <component>select - Dropdown selection</component>
      <component>sheet - Side panel</component>
      <component>skeleton - Loading placeholders</component>
      <component>skip-link - Accessibility link</component>
      <component>table - Data tables</component>
      <component>textarea - Multi-line text input</component>
      <component>tooltip - Hover hints</component>
    </shadcn-components>

    <custom-components>
      <component path="apps/web/src/components/approval/confidence-indicator.tsx">
        ConfidenceIndicator - Shows confidence score with visual bar
      </component>
      <component path="apps/web/src/components/approval/ai-reasoning-section.tsx">
        AIReasoningSection - Displays AI reasoning and factors
      </component>
    </custom-components>
  </ui-components-available>

  <implementation-guidance>
    <component-structure>
      <directory>apps/web/src/components/agents/</directory>
      <files-to-create>
        <file name="AgentCard.tsx">Base wrapper that exports all variants</file>
        <file name="AgentCardCompact.tsx">Minimal card for grid views</file>
        <file name="AgentCardStandard.tsx">Standard card with stats</file>
        <file name="AgentCardExpanded.tsx">Full card with actions</file>
        <file name="AgentAvatar.tsx">Reusable avatar with status indicator</file>
        <file name="AgentStatusBadge.tsx">Reusable status badge</file>
      </files-to-create>
    </component-structure>

    <type-file-to-create>
      <file>packages/shared/src/types/agent.ts</file>
      <exports>
        <export>Agent interface</export>
        <export>AgentTeam type</export>
        <export>AgentStatus type</export>
      </exports>
      <update-index>Add export to packages/shared/src/types/index.ts</update-index>
    </type-file-to-create>

    <status-colors>
      <online>
        <light>bg-green-100 text-green-700</light>
        <dark>dark:bg-green-900 dark:text-green-300</dark>
        <dot>bg-green-500 (with pulse animation)</dot>
      </online>
      <busy>
        <light>bg-yellow-100 text-yellow-700</light>
        <dark>dark:bg-yellow-900 dark:text-yellow-300</dark>
        <dot>bg-yellow-500</dot>
      </busy>
      <offline>
        <light>bg-gray-100 text-gray-700</light>
        <dark>dark:bg-gray-700 dark:text-gray-300</dark>
        <dot>bg-gray-500</dot>
      </offline>
      <error>
        <light>bg-red-100 text-red-700</light>
        <dark>dark:bg-red-900 dark:text-red-300</dark>
        <dot>bg-red-500</dot>
      </error>
    </status-colors>

    <animations>
      <pulse-dot>
        <description>Pulsing animation for online status indicator</description>
        <css><![CDATA[
@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.status-dot-online {
  animation: pulse-dot 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
]]></css>
        <location>Add to apps/web/src/app/globals.css or component CSS module</location>
      </pulse-dot>
      <reduced-motion>
        <note>Disable animations for users with reduced motion preference</note>
        <css><![CDATA[
@media (prefers-reduced-motion: reduce) {
  .status-dot-online {
    animation: none;
  }
}
]]></css>
      </reduced-motion>
    </animations>

    <avatar-sizes>
      <sm>h-8 w-8 (32px)</sm>
      <md>h-12 w-12 (48px)</md>
      <lg>h-16 w-16 (64px)</lg>
    </avatar-sizes>

    <card-layouts>
      <compact>
        <description>Horizontal layout for grid display</description>
        <height>~56px</height>
        <structure>Avatar (sm) + Name + Status dot inline</structure>
        <hover>border color change + subtle shadow</hover>
      </compact>
      <standard>
        <description>Vertical layout with stats</description>
        <height>~200px</height>
        <structure>
          <section>Avatar (md) + Status badge</section>
          <section>Name + Role</section>
          <section>Performance stats (tasks, success rate)</section>
        </structure>
      </standard>
      <expanded>
        <description>Extends standard with action buttons</description>
        <additional-section>Action buttons (Chat, Configure)</additional-section>
      </expanded>
    </card-layouts>

    <accessibility-requirements>
      <keyboard-navigation>All clickable cards must be keyboard accessible</keyboard-navigation>
      <aria-labels>Status indicators need aria-label for screen readers</aria-labels>
      <focus-visible>Clear focus states for keyboard navigation</focus-visible>
      <semantic-html>Use proper heading hierarchy (h3 for agent name)</semantic-html>
      <screen-reader>Status changes should be announced</screen-reader>
    </accessibility-requirements>

    <edge-cases>
      <missing-avatar>Fallback to default agent icon or first letter of name</missing-avatar>
      <long-names>Truncate with ellipsis, show full name on hover tooltip</long-names>
      <zero-stats>Show "0" instead of hiding, add "No activity yet" message</zero-stats>
      <offline-agents>Gray out card slightly, show last active timestamp</offline-agents>
      <error-state>Red accent, show error message with retry option</error-state>
    </edge-cases>

    <performance-considerations>
      <rendering>Cards are lightweight, no heavy computation</rendering>
      <memoization>Use React.memo for card components to prevent unnecessary re-renders</memoization>
      <lazy-loading>Avatar images should be lazy loaded</lazy-loading>
      <css-animations>Pulsing dot uses CSS animation (hardware accelerated)</css-animations>
    </performance-considerations>

    <testing-approach>
      <unit-tests>
        <test>AgentAvatar renders with emoji avatar</test>
        <test>AgentAvatar shows status indicator when showStatus=true</test>
        <test>AgentAvatar applies correct size class</test>
        <test>AgentStatusBadge renders with correct status colors</test>
        <test>AgentCardCompact calls onClick when clicked</test>
        <test>AgentCardCompact is keyboard navigable</test>
        <test>AgentCardStandard displays performance stats</test>
        <test>AgentCardStandard handles zero stats gracefully</test>
        <test>AgentCardExpanded renders action buttons</test>
        <test>AgentCardExpanded calls onChat/onConfigure callbacks</test>
      </unit-tests>
      <accessibility-tests>
        <test>Components pass axe accessibility audit</test>
        <test>Screen reader can navigate card contents</test>
        <test>Keyboard focus is visible</test>
      </accessibility-tests>
      <visual-tests>
        <test>Cards render correctly in light mode</test>
        <test>Cards render correctly in dark mode</test>
        <test>Status colors maintain contrast</test>
      </visual-tests>
    </testing-approach>

    <import-patterns>
      <example><![CDATA[
// External packages
import { useState } from 'react'
import { formatDistanceToNow } from 'date-fns'

// UI components
import { Card, CardHeader, CardContent, CardFooter } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar'

// Shared types
import type { Agent, AgentStatus } from '@hyvve/shared'

// Utils
import { cn } from '@/lib/utils'

// Local components
import { AgentAvatar } from './AgentAvatar'
import { AgentStatusBadge } from './AgentStatusBadge'
]]></example>
    </import-patterns>

    <component-composition>
      <hierarchy>
        <description>Each variant should compose from simpler components</description>
        <pattern>
          <compact>Uses AgentAvatar + inline status dot</compact>
          <standard>Uses AgentAvatar + AgentStatusBadge + stats section</standard>
          <expanded>Extends Standard with action buttons</expanded>
        </pattern>
      </hierarchy>
    </component-composition>
  </implementation-guidance>

  <related-documentation>
    <doc path="docs/epics/EPIC-13-ai-agent-management.md">Epic 13 Overview</doc>
    <doc path="docs/sprint-artifacts/tech-spec-epic-13.md">Epic 13 Technical Specification</doc>
    <doc path="docs/stories/13-1-agent-card-components.md">Story 13.1 Details</doc>
    <doc path="docs/design/wireframes/Finished wireframes and html files/">Wireframes AI-02</doc>
  </related-documentation>

  <next-steps>
    <step order="1">Create agent.ts type file in packages/shared/src/types/</step>
    <step order="2">Create agents/ directory in apps/web/src/components/</step>
    <step order="3">Implement AgentAvatar component with status indicator</step>
    <step order="4">Implement AgentStatusBadge component</step>
    <step order="5">Implement AgentCardCompact variant</step>
    <step order="6">Implement AgentCardStandard variant</step>
    <step order="7">Implement AgentCardExpanded variant</step>
    <step order="8">Create AgentCard.tsx wrapper with all exports</step>
    <step order="9">Add pulse-dot animation to globals.css</step>
    <step order="10">Write unit tests for all components</step>
    <step order="11">Test dark mode thoroughly</step>
    <step order="12">Verify accessibility requirements</step>
  </next-steps>

  <notes>
    <note type="critical">Agent types do not exist yet - must be created in packages/shared/src/types/agent.ts</note>
    <note type="critical">agents/ directory does not exist - must be created in apps/web/src/components/</note>
    <note type="pattern">Follow approval card pattern for variant switching and status colors</note>
    <note type="pattern">Use existing Avatar, Badge, Card, Button components from shadcn/ui</note>
    <note type="styling">All Tailwind classes must be complete strings (no dynamic interpolation)</note>
    <note type="animation">Pulse animation for online status should respect prefers-reduced-motion</note>
    <note type="accessibility">All interactive cards need keyboard navigation and aria-labels</note>
    <note type="performance">Use React.memo to prevent unnecessary re-renders in grid views</note>
  </notes>
</story-context>
